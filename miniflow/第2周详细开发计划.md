# MiniFlow ç¬¬2å‘¨è¯¦ç»†å¼€å‘è®¡åˆ’

## ğŸ“‹ å‘¨ç›®æ ‡æ¦‚è§ˆ

**å¼€å‘å‘¨æœŸ**: ç¬¬2å‘¨ (5å¤© Ã— 8å°æ—¶ = 40å°æ—¶)  
**ä¸»è¦ç›®æ ‡**: å®ç°å¯è§†åŒ–æµç¨‹å»ºæ¨¡å™¨å’Œæµç¨‹å®šä¹‰ç®¡ç†åŠŸèƒ½  
**æŠ€æœ¯é‡ç‚¹**: ReactFlowé›†æˆã€æµç¨‹æ•°æ®æ¨¡å‹ã€å¯è§†åŒ–ç¼–è¾‘å™¨  
**äº¤ä»˜æˆæœ**: å®Œæ•´çš„æµç¨‹è®¾è®¡å’Œç®¡ç†ç³»ç»Ÿ

---

## ğŸ“… æ¯æ—¥å¼€å‘è®¡åˆ’

### Day 6 (Monday) - 8å°æ—¶
**ä¸»é¢˜**: æµç¨‹æ•°æ®æ¨¡å‹è®¾è®¡å’Œåç«¯API

#### ä¸Šåˆ (4å°æ—¶)
**9:00-11:00 æµç¨‹æ•°æ®æ¨¡å‹è®¾è®¡ (2å°æ—¶)**

åˆ›å»º `internal/model/process.go`:
```go
// ProcessDefinition æµç¨‹å®šä¹‰æ¨¡å‹
type ProcessDefinition struct {
    BaseModel
    Key            string    `gorm:"type:varchar(100);not null;uniqueIndex" json:"key"`
    Name           string    `gorm:"type:varchar(255);not null;index" json:"name"`
    Version        int       `gorm:"not null;default:1" json:"version"`
    Description    string    `gorm:"type:text" json:"description"`
    Category       string    `gorm:"type:varchar(50);index" json:"category"`
    DefinitionJSON string    `gorm:"type:json;not null" json:"definition_json"`
    Status         string    `gorm:"type:varchar(20);not null;default:draft;index" json:"status"`
    CreatedBy      uint      `gorm:"not null;index" json:"created_by"`
    
    // å…³è”å…³ç³»
    Creator   User              `gorm:"foreignKey:CreatedBy" json:"creator,omitempty"`
    Instances []ProcessInstance `gorm:"foreignKey:DefinitionID" json:"instances,omitempty"`
}

// ProcessNode æµç¨‹èŠ‚ç‚¹
type ProcessNode struct {
    ID       string            `json:"id"`
    Type     string            `json:"type"` // start, end, userTask, serviceTask, gateway
    Name     string            `json:"name"`
    X        float64           `json:"x"`
    Y        float64           `json:"y"`
    Props    map[string]interface{} `json:"props,omitempty"`
}

// ProcessFlow æµç¨‹è¿çº¿
type ProcessFlow struct {
    ID        string `json:"id"`
    From      string `json:"from"`
    To        string `json:"to"`
    Condition string `json:"condition,omitempty"`
    Label     string `json:"label,omitempty"`
}

// ProcessDefinitionData æµç¨‹å®šä¹‰æ•°æ®ç»“æ„
type ProcessDefinitionData struct {
    Nodes []ProcessNode `json:"nodes"`
    Flows []ProcessFlow `json:"flows"`
}
```

**11:00-13:00 æµç¨‹Repositoryå±‚ (2å°æ—¶)**

åˆ›å»º `internal/repository/process.go`:
```go
type ProcessRepository struct {
    db     *database.Database
    logger *logger.Logger
}

func NewProcessRepository(db *database.Database, logger *logger.Logger) *ProcessRepository {
    return &ProcessRepository{db: db, logger: logger}
}

// CRUDæ“ä½œ
func (r *ProcessRepository) Create(process *model.ProcessDefinition) error
func (r *ProcessRepository) GetByID(id uint) (*model.ProcessDefinition, error)
func (r *ProcessRepository) GetByKey(key string) (*model.ProcessDefinition, error)
func (r *ProcessRepository) Update(process *model.ProcessDefinition) error
func (r *ProcessRepository) Delete(id uint) error
func (r *ProcessRepository) List(offset, limit int, filters map[string]interface{}) ([]*model.ProcessDefinition, int64, error)

// ç‰ˆæœ¬ç®¡ç†
func (r *ProcessRepository) GetLatestVersion(key string) (*model.ProcessDefinition, error)
func (r *ProcessRepository) GetVersions(key string) ([]*model.ProcessDefinition, error)
func (r *ProcessRepository) CreateVersion(process *model.ProcessDefinition) error

// åˆ†ç±»å’Œæœç´¢
func (r *ProcessRepository) GetByCategory(category string) ([]*model.ProcessDefinition, error)
func (r *ProcessRepository) Search(keyword string) ([]*model.ProcessDefinition, error)
```

#### ä¸‹åˆ (4å°æ—¶)
**14:00-16:00 æµç¨‹Serviceå±‚ (2å°æ—¶)**

åˆ›å»º `internal/service/process.go`:
```go
type ProcessService struct {
    processRepo *repository.ProcessRepository
    userRepo    *repository.UserRepository
    logger      *logger.Logger
}

// è¯·æ±‚å“åº”ç»“æ„
type CreateProcessRequest struct {
    Key         string                    `json:"key" validate:"required,min=3,max=100"`
    Name        string                    `json:"name" validate:"required,min=1,max=255"`
    Description string                    `json:"description"`
    Category    string                    `json:"category"`
    Definition  model.ProcessDefinitionData `json:"definition"`
}

type UpdateProcessRequest struct {
    Name        string                    `json:"name" validate:"required,min=1,max=255"`
    Description string                    `json:"description"`
    Category    string                    `json:"category"`
    Definition  model.ProcessDefinitionData `json:"definition"`
}

// ä¸šåŠ¡é€»è¾‘æ–¹æ³•
func (s *ProcessService) CreateProcess(userID uint, req *CreateProcessRequest) (*model.ProcessDefinition, error)
func (s *ProcessService) UpdateProcess(processID uint, userID uint, req *UpdateProcessRequest) (*model.ProcessDefinition, error)
func (s *ProcessService) GetProcess(processID uint) (*model.ProcessDefinition, error)
func (s *ProcessService) DeleteProcess(processID uint, userID uint) error
func (s *ProcessService) GetUserProcesses(userID uint, page, pageSize int) ([]*model.ProcessDefinition, int64, error)
func (s *ProcessService) ValidateProcessDefinition(definition *model.ProcessDefinitionData) error
```

**16:00-18:00 æµç¨‹Handlerå±‚ (2å°æ—¶)**

åˆ›å»º `internal/handler/process.go`:
```go
type ProcessHandler struct {
    processService *service.ProcessService
    logger         *logger.Logger
    validator      *utils.CustomValidator
}

// APIå¤„ç†æ–¹æ³•
func (h *ProcessHandler) CreateProcess(c echo.Context) error
func (h *ProcessHandler) GetProcess(c echo.Context) error
func (h *ProcessHandler) UpdateProcess(c echo.Context) error
func (h *ProcessHandler) DeleteProcess(c echo.Context) error
func (h *ProcessHandler) GetProcesses(c echo.Context) error
func (h *ProcessHandler) GetProcessVersions(c echo.Context) error
```

#### ğŸ“ Day 6 äº¤ä»˜æ¸…å•
- [ ] æµç¨‹æ•°æ®æ¨¡å‹å®Œæˆ
- [ ] æµç¨‹Repositoryå±‚å®ç°
- [ ] æµç¨‹Serviceå±‚ä¸šåŠ¡é€»è¾‘
- [ ] æµç¨‹Handlerå±‚APIæ¥å£
- [ ] æ•°æ®åº“è¿ç§»å’Œç´¢å¼•

---

### Day 7 (Tuesday) - 8å°æ—¶
**ä¸»é¢˜**: ReactFlowé›†æˆå’ŒåŸºç¡€æµç¨‹å»ºæ¨¡å™¨

#### ä¸Šåˆ (4å°æ—¶)
**9:00-11:00 ReactFlowåŸºç¡€é›†æˆ (2å°æ—¶)**

å®‰è£…ä¾èµ–å’ŒåŸºç¡€é…ç½®:
```bash
cd frontend
npm install reactflow @reactflow/core @reactflow/background @reactflow/controls @reactflow/minimap
```

åˆ›å»º `src/types/process.ts`:
```typescript
export interface ProcessNode {
  id: string;
  type: 'start' | 'end' | 'userTask' | 'serviceTask' | 'gateway';
  position: { x: number; y: number };
  data: {
    label: string;
    assignee?: string;
    condition?: string;
    [key: string]: any;
  };
}

export interface ProcessEdge {
  id: string;
  source: string;
  target: string;
  label?: string;
  type?: string;
  data?: {
    condition?: string;
  };
}

export interface ProcessDefinition {
  id?: number;
  key: string;
  name: string;
  description?: string;
  category?: string;
  version: number;
  status: 'draft' | 'published' | 'archived';
  definition: {
    nodes: ProcessNode[];
    edges: ProcessEdge[];
  };
  created_by: number;
  created_at: string;
  updated_at: string;
}
```

**11:00-13:00 è‡ªå®šä¹‰èŠ‚ç‚¹ç»„ä»¶ (2å°æ—¶)**

åˆ›å»º `src/components/process/nodes/StartNode.tsx`:
```tsx
import React from 'react';
import { Handle, Position, NodeProps } from 'reactflow';

const StartNode: React.FC<NodeProps> = ({ data, selected }) => {
  return (
    <div className={`custom-node start-node ${selected ? 'selected' : ''}`}>
      <div className="node-header">
        <span className="node-icon">â­•</span>
        <span className="node-label">å¼€å§‹</span>
      </div>
      <Handle type="source" position={Position.Right} />
    </div>
  );
};

export default StartNode;
```

ç±»ä¼¼åœ°åˆ›å»º `EndNode.tsx`, `UserTaskNode.tsx`, `GatewayNode.tsx`

#### ä¸‹åˆ (4å°æ—¶)
**14:00-16:00 æµç¨‹è®¾è®¡å™¨ä¸»ç»„ä»¶ (2å°æ—¶)**

åˆ›å»º `src/components/process/ProcessDesigner.tsx`:
```tsx
import React, { useCallback, useState } from 'react';
import ReactFlow, {
  addEdge,
  Background,
  Controls,
  MiniMap,
  useNodesState,
  useEdgesState,
  Connection,
  Edge,
  NodeTypes,
} from 'reactflow';
import 'reactflow/dist/style.css';

import StartNode from './nodes/StartNode';
import EndNode from './nodes/EndNode';
import UserTaskNode from './nodes/UserTaskNode';
import GatewayNode from './nodes/GatewayNode';

const nodeTypes: NodeTypes = {
  start: StartNode,
  end: EndNode,
  userTask: UserTaskNode,
  gateway: GatewayNode,
};

const ProcessDesigner: React.FC = () => {
  const [nodes, setNodes, onNodesChange] = useNodesState([]);
  const [edges, setEdges, onEdgesChange] = useEdgesState([]);

  const onConnect = useCallback(
    (params: Connection) => {
      const edge: Edge = {
        ...params,
        id: `edge-${params.source}-${params.target}`,
        type: 'smoothstep',
        animated: true,
      };
      setEdges((eds) => addEdge(edge, eds));
    },
    [setEdges]
  );

  return (
    <div className="process-designer">
      <ReactFlow
        nodes={nodes}
        edges={edges}
        onNodesChange={onNodesChange}
        onEdgesChange={onEdgesChange}
        onConnect={onConnect}
        nodeTypes={nodeTypes}
        fitView
      >
        <Background variant="dots" gap={20} size={1} />
        <Controls />
        <MiniMap />
      </ReactFlow>
    </div>
  );
};

export default ProcessDesigner;
```

**16:00-18:00 èŠ‚ç‚¹å·¥å…·æ  (2å°æ—¶)**

åˆ›å»º `src/components/process/NodePalette.tsx`:
```tsx
import React from 'react';
import { Card, Space, Button } from 'antd';
import { 
  PlayCircleOutlined, 
  StopOutlined, 
  UserOutlined, 
  BranchesOutlined 
} from '@ant-design/icons';

interface NodePaletteProps {
  onAddNode: (type: string) => void;
}

const NodePalette: React.FC<NodePaletteProps> = ({ onAddNode }) => {
  const nodeTypes = [
    { type: 'start', label: 'å¼€å§‹', icon: <PlayCircleOutlined />, color: '#52c41a' },
    { type: 'userTask', label: 'ç”¨æˆ·ä»»åŠ¡', icon: <UserOutlined />, color: '#1890ff' },
    { type: 'gateway', label: 'æ¡ä»¶ç½‘å…³', icon: <BranchesOutlined />, color: '#fa8c16' },
    { type: 'end', label: 'ç»“æŸ', icon: <StopOutlined />, color: '#f5222d' },
  ];

  return (
    <Card title="èŠ‚ç‚¹å·¥å…·ç®±" size="small" className="node-palette">
      <Space direction="vertical" style={{ width: '100%' }}>
        {nodeTypes.map(nodeType => (
          <Button
            key={nodeType.type}
            block
            icon={nodeType.icon}
            style={{ 
              borderColor: nodeType.color,
              color: nodeType.color 
            }}
            onClick={() => onAddNode(nodeType.type)}
          >
            {nodeType.label}
          </Button>
        ))}
      </Space>
    </Card>
  );
};

export default NodePalette;
```

#### ğŸ“ Day 7 äº¤ä»˜æ¸…å•
- [ ] ReactFlowåŸºç¡€é›†æˆå®Œæˆ
- [ ] è‡ªå®šä¹‰èŠ‚ç‚¹ç»„ä»¶å®ç°
- [ ] æµç¨‹è®¾è®¡å™¨ä¸»ç»„ä»¶
- [ ] èŠ‚ç‚¹å·¥å…·æ åŠŸèƒ½

---

### Day 8 (Wednesday) - 8å°æ—¶
**ä¸»é¢˜**: æµç¨‹å»ºæ¨¡åŠŸèƒ½å’Œæ•°æ®è½¬æ¢

#### ä¸Šåˆ (4å°æ—¶)
**9:00-11:00 è¿çº¿å’Œç”»å¸ƒæ“ä½œ (2å°æ—¶)**

å¢å¼º ProcessDesigner åŠŸèƒ½:
```tsx
// æ·»åŠ åˆ° ProcessDesigner.tsx
const [selectedNode, setSelectedNode] = useState<string | null>(null);
const [selectedEdge, setSelectedEdge] = useState<string | null>(null);

// èŠ‚ç‚¹æ‹–æ‹½ç»“æŸå¤„ç†
const onNodeDragStop = useCallback((event: MouseEvent, node: Node) => {
  // ä¿å­˜èŠ‚ç‚¹ä½ç½®
  console.log('Node moved:', node.id, node.position);
}, []);

// èŠ‚ç‚¹é€‰æ‹©å¤„ç†
const onNodeClick = useCallback((event: MouseEvent, node: Node) => {
  setSelectedNode(node.id);
  setSelectedEdge(null);
}, []);

// è¿çº¿é€‰æ‹©å¤„ç†
const onEdgeClick = useCallback((event: MouseEvent, edge: Edge) => {
  setSelectedEdge(edge.id);
  setSelectedNode(null);
}, []);

// åˆ é™¤é€‰ä¸­å…ƒç´ 
const onDeleteSelected = useCallback(() => {
  if (selectedNode) {
    setNodes(nds => nds.filter(n => n.id !== selectedNode));
    setSelectedNode(null);
  }
  if (selectedEdge) {
    setEdges(eds => eds.filter(e => e.id !== selectedEdge));
    setSelectedEdge(null);
  }
}, [selectedNode, selectedEdge, setNodes, setEdges]);
```

**11:00-13:00 èŠ‚ç‚¹å±æ€§ç¼–è¾‘é¢æ¿ (2å°æ—¶)**

åˆ›å»º `src/components/process/NodePropertiesPanel.tsx`:
```tsx
import React from 'react';
import { Card, Form, Input, Select, Button, Space } from 'antd';
import { DeleteOutlined, EditOutlined } from '@ant-design/icons';

interface NodePropertiesPanelProps {
  selectedNode: any;
  onUpdateNode: (nodeId: string, updates: any) => void;
  onDeleteNode: (nodeId: string) => void;
}

const NodePropertiesPanel: React.FC<NodePropertiesPanelProps> = ({
  selectedNode,
  onUpdateNode,
  onDeleteNode
}) => {
  const [form] = Form.useForm();

  if (!selectedNode) {
    return (
      <Card title="å±æ€§é¢æ¿" size="small">
        <p>è¯·é€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹æ¥ç¼–è¾‘å±æ€§</p>
      </Card>
    );
  }

  const handleSave = (values: any) => {
    onUpdateNode(selectedNode.id, values);
  };

  return (
    <Card 
      title="èŠ‚ç‚¹å±æ€§" 
      size="small"
      extra={
        <Space>
          <Button 
            type="text" 
            icon={<EditOutlined />} 
            size="small"
          />
          <Button 
            type="text" 
            danger 
            icon={<DeleteOutlined />} 
            size="small"
            onClick={() => onDeleteNode(selectedNode.id)}
          />
        </Space>
      }
    >
      <Form
        form={form}
        layout="vertical"
        initialValues={selectedNode.data}
        onFinish={handleSave}
        size="small"
      >
        <Form.Item name="label" label="èŠ‚ç‚¹åç§°">
          <Input placeholder="è¾“å…¥èŠ‚ç‚¹åç§°" />
        </Form.Item>
        
        {selectedNode.type === 'userTask' && (
          <Form.Item name="assignee" label="å¤„ç†äºº">
            <Select placeholder="é€‰æ‹©å¤„ç†äºº">
              <Select.Option value="admin">ç®¡ç†å‘˜</Select.Option>
              <Select.Option value="user">æ™®é€šç”¨æˆ·</Select.Option>
            </Select>
          </Form.Item>
        )}
        
        {selectedNode.type === 'gateway' && (
          <Form.Item name="condition" label="æ¡ä»¶è¡¨è¾¾å¼">
            <Input.TextArea 
              placeholder="è¾“å…¥æ¡ä»¶è¡¨è¾¾å¼ï¼Œå¦‚: approved == true"
              rows={3}
            />
          </Form.Item>
        )}
        
        <Form.Item>
          <Button type="primary" htmlType="submit" size="small" block>
            ä¿å­˜æ›´æ”¹
          </Button>
        </Form.Item>
      </Form>
    </Card>
  );
};

export default NodePropertiesPanel;
```

#### ä¸‹åˆ (4å°æ—¶)
**14:00-16:00 æ•°æ®è½¬æ¢åŠŸèƒ½ (2å°æ—¶)**

åˆ›å»º `src/utils/processConverter.ts`:
```typescript
import { Node, Edge } from 'reactflow';
import { ProcessDefinition, ProcessNode, ProcessFlow } from '../types/process';

export class ProcessConverter {
  // ReactFlowæ ¼å¼è½¬æ¢ä¸ºå†…éƒ¨æ ¼å¼
  static reactFlowToInternal(nodes: Node[], edges: Edge[]): {
    nodes: ProcessNode[];
    flows: ProcessFlow[];
  } {
    const processNodes: ProcessNode[] = nodes.map(node => ({
      id: node.id,
      type: node.type || 'userTask',
      name: node.data.label || '',
      x: node.position.x,
      y: node.position.y,
      props: {
        assignee: node.data.assignee,
        condition: node.data.condition,
        ...node.data
      }
    }));

    const processFlows: ProcessFlow[] = edges.map(edge => ({
      id: edge.id,
      from: edge.source,
      to: edge.target,
      condition: edge.data?.condition || '',
      label: edge.label as string || ''
    }));

    return { nodes: processNodes, flows: processFlows };
  }

  // å†…éƒ¨æ ¼å¼è½¬æ¢ä¸ºReactFlowæ ¼å¼
  static internalToReactFlow(definition: ProcessDefinitionData): {
    nodes: Node[];
    edges: Edge[];
  } {
    const reactNodes: Node[] = definition.nodes.map(node => ({
      id: node.id,
      type: node.type,
      position: { x: node.x, y: node.y },
      data: {
        label: node.name,
        assignee: node.props?.assignee,
        condition: node.props?.condition,
        ...node.props
      }
    }));

    const reactEdges: Edge[] = definition.flows.map(flow => ({
      id: flow.id,
      source: flow.from,
      target: flow.to,
      label: flow.label,
      type: 'smoothstep',
      animated: true,
      data: {
        condition: flow.condition
      }
    }));

    return { nodes: reactNodes, edges: reactEdges };
  }

  // éªŒè¯æµç¨‹å®šä¹‰
  static validateProcess(nodes: ProcessNode[], flows: ProcessFlow[]): {
    isValid: boolean;
    errors: string[];
  } {
    const errors: string[] = [];

    // æ£€æŸ¥å¿…éœ€çš„å¼€å§‹å’Œç»“æŸèŠ‚ç‚¹
    const startNodes = nodes.filter(n => n.type === 'start');
    const endNodes = nodes.filter(n => n.type === 'end');

    if (startNodes.length === 0) {
      errors.push('æµç¨‹å¿…é¡»åŒ…å«ä¸€ä¸ªå¼€å§‹èŠ‚ç‚¹');
    }
    if (startNodes.length > 1) {
      errors.push('æµç¨‹åªèƒ½åŒ…å«ä¸€ä¸ªå¼€å§‹èŠ‚ç‚¹');
    }
    if (endNodes.length === 0) {
      errors.push('æµç¨‹å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªç»“æŸèŠ‚ç‚¹');
    }

    // æ£€æŸ¥èŠ‚ç‚¹è¿æ¥
    nodes.forEach(node => {
      if (node.type !== 'end') {
        const outgoingFlows = flows.filter(f => f.from === node.id);
        if (outgoingFlows.length === 0) {
          errors.push(`èŠ‚ç‚¹ "${node.name}" ç¼ºå°‘å‡ºå£è¿çº¿`);
        }
      }
      if (node.type !== 'start') {
        const incomingFlows = flows.filter(f => f.to === node.id);
        if (incomingFlows.length === 0) {
          errors.push(`èŠ‚ç‚¹ "${node.name}" ç¼ºå°‘å…¥å£è¿çº¿`);
        }
      }
    });

    return {
      isValid: errors.length === 0,
      errors
    };
  }
}
```

**16:00-18:00 æµç¨‹è®¾è®¡å™¨é¡µé¢é›†æˆ (2å°æ—¶)**

åˆ›å»º `src/pages/process/ProcessDesign.tsx`:
```tsx
import React, { useState, useCallback } from 'react';
import { Row, Col, Card, Button, Space, message } from 'antd';
import { SaveOutlined, UndoOutlined, RedoOutlined, ClearOutlined } from '@ant-design/icons';
import { Node, Edge } from 'reactflow';

import ProcessDesigner from '../../components/process/ProcessDesigner';
import NodePalette from '../../components/process/NodePalette';
import NodePropertiesPanel from '../../components/process/NodePropertiesPanel';
import { ProcessConverter } from '../../utils/processConverter';

const ProcessDesign: React.FC = () => {
  const [nodes, setNodes] = useState<Node[]>([]);
  const [edges, setEdges] = useState<Edge[]>([]);
  const [selectedNode, setSelectedNode] = useState<Node | null>(null);
  const [processName, setProcessName] = useState('æ–°æµç¨‹');

  // æ·»åŠ èŠ‚ç‚¹
  const handleAddNode = useCallback((type: string) => {
    const newNode: Node = {
      id: `${type}-${Date.now()}`,
      type,
      position: { x: Math.random() * 400, y: Math.random() * 400 },
      data: { label: `${type === 'start' ? 'å¼€å§‹' : type === 'end' ? 'ç»“æŸ' : 'æ–°ä»»åŠ¡'}` }
    };
    setNodes(nds => [...nds, newNode]);
  }, [setNodes]);

  // ä¿å­˜æµç¨‹
  const handleSave = useCallback(() => {
    const { nodes: processNodes, flows } = ProcessConverter.reactFlowToInternal(nodes, edges);
    const validation = ProcessConverter.validateProcess(processNodes, flows);
    
    if (!validation.isValid) {
      message.error(`æµç¨‹éªŒè¯å¤±è´¥: ${validation.errors.join(', ')}`);
      return;
    }

    // è°ƒç”¨APIä¿å­˜
    console.log('Saving process:', { nodes: processNodes, flows });
    message.success('æµç¨‹ä¿å­˜æˆåŠŸ');
  }, [nodes, edges]);

  return (
    <div className="process-design-page">
      <Row gutter={[8, 8]} style={{ height: '100%' }}>
        <Col span={4}>
          <Space direction="vertical" style={{ width: '100%' }}>
            <NodePalette onAddNode={handleAddNode} />
            <NodePropertiesPanel 
              selectedNode={selectedNode}
              onUpdateNode={(nodeId, updates) => {
                setNodes(nds => nds.map(n => 
                  n.id === nodeId ? { ...n, data: { ...n.data, ...updates } } : n
                ));
              }}
              onDeleteNode={(nodeId) => {
                setNodes(nds => nds.filter(n => n.id !== nodeId));
                setEdges(eds => eds.filter(e => e.source !== nodeId && e.target !== nodeId));
                setSelectedNode(null);
              }}
            />
          </Space>
        </Col>
        
        <Col span={20}>
          <Card 
            title={processName}
            size="small"
            extra={
              <Space>
                <Button icon={<UndoOutlined />} size="small">æ’¤é”€</Button>
                <Button icon={<RedoOutlined />} size="small">é‡åš</Button>
                <Button icon={<ClearOutlined />} size="small">æ¸…ç©º</Button>
                <Button 
                  type="primary" 
                  icon={<SaveOutlined />} 
                  size="small"
                  onClick={handleSave}
                >
                  ä¿å­˜
                </Button>
              </Space>
            }
            bodyStyle={{ padding: 0, height: 'calc(100vh - 140px)' }}
          >
            <ProcessDesigner 
              nodes={nodes}
              edges={edges}
              onNodesChange={(changes) => {/* å¤„ç†èŠ‚ç‚¹å˜åŒ– */}}
              onEdgesChange={(changes) => {/* å¤„ç†è¿çº¿å˜åŒ– */}}
              onNodeSelect={setSelectedNode}
            />
          </Card>
        </Col>
      </Row>
    </div>
  );
};

export default ProcessDesign;
```

#### ğŸ“ Day 8 äº¤ä»˜æ¸…å•
- [ ] ReactFlowé›†æˆå®Œæˆ
- [ ] è‡ªå®šä¹‰èŠ‚ç‚¹ç»„ä»¶å®ç°
- [ ] èŠ‚ç‚¹å·¥å…·æ åŠŸèƒ½
- [ ] æ•°æ®è½¬æ¢å·¥å…·å®ç°
- [ ] æµç¨‹è®¾è®¡å™¨é¡µé¢é›†æˆ

---

### Day 9 (Thursday) - 8å°æ—¶
**ä¸»é¢˜**: æµç¨‹åˆ—è¡¨é¡µé¢å’ŒAPIé›†æˆ

#### ä¸Šåˆ (4å°æ—¶)
**9:00-11:00 æµç¨‹åˆ—è¡¨é¡µé¢ (2å°æ—¶)**

åˆ›å»º `src/pages/process/ProcessList.tsx`:
```tsx
import React, { useState, useEffect } from 'react';
import { 
  Table, 
  Card, 
  Button, 
  Space, 
  Tag, 
  Dropdown, 
  Input, 
  Select,
  Modal,
  message 
} from 'antd';
import { 
  PlusOutlined, 
  EditOutlined, 
  DeleteOutlined, 
  CopyOutlined,
  EyeOutlined,
  SearchOutlined 
} from '@ant-design/icons';
import { useNavigate } from 'react-router-dom';
import { formatRelativeTime } from '../../utils/formatters';

const ProcessList: React.FC = () => {
  const navigate = useNavigate();
  const [processes, setProcesses] = useState([]);
  const [loading, setLoading] = useState(false);
  const [searchText, setSearchText] = useState('');
  const [categoryFilter, setCategoryFilter] = useState('all');

  const columns = [
    {
      title: 'æµç¨‹åç§°',
      dataIndex: 'name',
      key: 'name',
      render: (name: string, record: any) => (
        <Space>
          <span style={{ fontWeight: 500 }}>{name}</span>
          <Tag color="blue">v{record.version}</Tag>
        </Space>
      ),
    },
    {
      title: 'æµç¨‹æ ‡è¯†',
      dataIndex: 'key',
      key: 'key',
      render: (key: string) => <code>{key}</code>,
    },
    {
      title: 'åˆ†ç±»',
      dataIndex: 'category',
      key: 'category',
      render: (category: string) => category ? <Tag>{category}</Tag> : '-',
    },
    {
      title: 'çŠ¶æ€',
      dataIndex: 'status',
      key: 'status',
      render: (status: string) => {
        const statusConfig = {
          draft: { color: 'orange', text: 'è‰ç¨¿' },
          published: { color: 'green', text: 'å·²å‘å¸ƒ' },
          archived: { color: 'default', text: 'å·²å½’æ¡£' },
        };
        const config = statusConfig[status] || statusConfig.draft;
        return <Tag color={config.color}>{config.text}</Tag>;
      },
    },
    {
      title: 'åˆ›å»ºæ—¶é—´',
      dataIndex: 'created_at',
      key: 'created_at',
      render: (time: string) => formatRelativeTime(time),
    },
    {
      title: 'æ“ä½œ',
      key: 'actions',
      render: (_, record: any) => (
        <Space>
          <Button 
            type="text" 
            icon={<EyeOutlined />} 
            size="small"
            onClick={() => navigate(`/process/${record.id}/view`)}
          >
            æŸ¥çœ‹
          </Button>
          <Button 
            type="text" 
            icon={<EditOutlined />} 
            size="small"
            onClick={() => navigate(`/process/${record.id}/edit`)}
          >
            ç¼–è¾‘
          </Button>
          <Dropdown
            menu={{
              items: [
                {
                  key: 'copy',
                  icon: <CopyOutlined />,
                  label: 'å¤åˆ¶',
                  onClick: () => handleCopyProcess(record.id),
                },
                {
                  key: 'delete',
                  icon: <DeleteOutlined />,
                  label: 'åˆ é™¤',
                  danger: true,
                  onClick: () => handleDeleteProcess(record.id),
                },
              ],
            }}
          >
            <Button type="text" size="small">æ›´å¤š</Button>
          </Dropdown>
        </Space>
      ),
    },
  ];

  return (
    <div className="process-list-page">
      <Card 
        title="æµç¨‹ç®¡ç†"
        extra={
          <Button 
            type="primary" 
            icon={<PlusOutlined />}
            onClick={() => navigate('/process/create')}
          >
            åˆ›å»ºæµç¨‹
          </Button>
        }
      >
        <Space direction="vertical" style={{ width: '100%' }}>
          <Row gutter={[16, 16]}>
            <Col span={8}>
              <Input
                placeholder="æœç´¢æµç¨‹åç§°æˆ–æ ‡è¯†"
                prefix={<SearchOutlined />}
                value={searchText}
                onChange={(e) => setSearchText(e.target.value)}
              />
            </Col>
            <Col span={6}>
              <Select
                placeholder="é€‰æ‹©åˆ†ç±»"
                style={{ width: '100%' }}
                value={categoryFilter}
                onChange={setCategoryFilter}
              >
                <Select.Option value="all">å…¨éƒ¨åˆ†ç±»</Select.Option>
                <Select.Option value="approval">å®¡æ‰¹æµç¨‹</Select.Option>
                <Select.Option value="workflow">å·¥ä½œæµç¨‹</Select.Option>
              </Select>
            </Col>
          </Row>
          
          <Table
            columns={columns}
            dataSource={processes}
            loading={loading}
            rowKey="id"
            pagination={{
              pageSize: 20,
              showSizeChanger: true,
              showQuickJumper: true,
              showTotal: (total) => `å…± ${total} æ¡è®°å½•`,
            }}
          />
        </Space>
      </Card>
    </div>
  );
};

export default ProcessList;
```

**11:00-13:00 æµç¨‹APIæœåŠ¡ (2å°æ—¶)**

åˆ›å»º `src/services/processApi.ts`:
```typescript
import { http } from '../utils/http';
import { ProcessDefinition, CreateProcessRequest, UpdateProcessRequest } from '../types/process';
import { PaginationParams } from '../types/api';

export const processApi = {
  // åˆ›å»ºæµç¨‹
  async createProcess(data: CreateProcessRequest): Promise<ProcessDefinition> {
    const response = await http.post<ProcessDefinition>('/process', data);
    if ('error' in response.data) {
      throw new Error(response.data.error);
    }
    return response.data.data!;
  },

  // è·å–æµç¨‹åˆ—è¡¨
  async getProcesses(params?: PaginationParams & {
    search?: string;
    category?: string;
    status?: string;
  }): Promise<{
    processes: ProcessDefinition[];
    total: number;
    page: number;
    page_size: number;
  }> {
    const queryParams = new URLSearchParams();
    if (params?.page) queryParams.append('page', params.page.toString());
    if (params?.page_size) queryParams.append('page_size', params.page_size.toString());
    if (params?.search) queryParams.append('search', params.search);
    if (params?.category) queryParams.append('category', params.category);
    if (params?.status) queryParams.append('status', params.status);
    
    const url = `/process${queryParams.toString() ? `?${queryParams.toString()}` : ''}`;
    const response = await http.get(url);
    if ('error' in response.data) {
      throw new Error(response.data.error);
    }
    return response.data.data!;
  },

  // è·å–æµç¨‹è¯¦æƒ…
  async getProcess(id: number): Promise<ProcessDefinition> {
    const response = await http.get<ProcessDefinition>(`/process/${id}`);
    if ('error' in response.data) {
      throw new Error(response.data.error);
    }
    return response.data.data!;
  },

  // æ›´æ–°æµç¨‹
  async updateProcess(id: number, data: UpdateProcessRequest): Promise<ProcessDefinition> {
    const response = await http.put<ProcessDefinition>(`/process/${id}`, data);
    if ('error' in response.data) {
      throw new Error(response.data.error);
    }
    return response.data.data!;
  },

  // åˆ é™¤æµç¨‹
  async deleteProcess(id: number): Promise<void> {
    const response = await http.delete(`/process/${id}`);
    if ('error' in response.data) {
      throw new Error(response.data.error);
    }
  },

  // å¤åˆ¶æµç¨‹
  async copyProcess(id: number): Promise<ProcessDefinition> {
    const response = await http.post<ProcessDefinition>(`/process/${id}/copy`);
    if ('error' in response.data) {
      throw new Error(response.data.error);
    }
    return response.data.data!;
  },
};
```

#### ğŸ“ Day 9 äº¤ä»˜æ¸…å•
- [ ] æµç¨‹åˆ—è¡¨é¡µé¢å®Œæˆ
- [ ] æµç¨‹APIæœåŠ¡å®ç°
- [ ] æœç´¢å’Œç­›é€‰åŠŸèƒ½
- [ ] æµç¨‹æ“ä½œåŠŸèƒ½(æŸ¥çœ‹ã€ç¼–è¾‘ã€åˆ é™¤ã€å¤åˆ¶)

---

### Day 10 (Friday) - 8å°æ—¶
**ä¸»é¢˜**: æµç¨‹åˆ›å»ºç¼–è¾‘é¡µé¢å’Œå®Œæ•´é›†æˆ

#### ä¸Šåˆ (4å°æ—¶)
**9:00-11:00 æµç¨‹åˆ›å»º/ç¼–è¾‘é¡µé¢ (2å°æ—¶)**

åˆ›å»º `src/pages/process/ProcessEdit.tsx`:
```tsx
import React, { useState, useEffect } from 'react';
import { Form, Input, Select, Button, Space, Card, Row, Col, message } from 'antd';
import { SaveOutlined, ArrowLeftOutlined } from '@ant-design/icons';
import { useNavigate, useParams } from 'react-router-dom';
import ProcessDesigner from '../../components/process/ProcessDesigner';
import { processApi } from '../../services/processApi';

const ProcessEdit: React.FC = () => {
  const navigate = useNavigate();
  const { id } = useParams<{ id: string }>();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [saving, setSaving] = useState(false);
  const [processData, setProcessData] = useState(null);

  // åŠ è½½æµç¨‹æ•°æ®
  useEffect(() => {
    if (id && id !== 'create') {
      loadProcess(parseInt(id));
    }
  }, [id]);

  const loadProcess = async (processId: number) => {
    setLoading(true);
    try {
      const process = await processApi.getProcess(processId);
      setProcessData(process);
      form.setFieldsValue({
        name: process.name,
        key: process.key,
        description: process.description,
        category: process.category,
      });
    } catch (error) {
      message.error('åŠ è½½æµç¨‹å¤±è´¥');
    } finally {
      setLoading(false);
    }
  };

  const handleSave = async (values: any) => {
    setSaving(true);
    try {
      if (id === 'create') {
        await processApi.createProcess(values);
        message.success('æµç¨‹åˆ›å»ºæˆåŠŸ');
      } else {
        await processApi.updateProcess(parseInt(id!), values);
        message.success('æµç¨‹æ›´æ–°æˆåŠŸ');
      }
      navigate('/process');
    } catch (error) {
      message.error('ä¿å­˜å¤±è´¥');
    } finally {
      setSaving(false);
    }
  };

  return (
    <div className="process-edit-page">
      <Card 
        title={
          <Space>
            <Button 
              type="text" 
              icon={<ArrowLeftOutlined />}
              onClick={() => navigate('/process')}
            >
              è¿”å›åˆ—è¡¨
            </Button>
            <span>{id === 'create' ? 'åˆ›å»ºæµç¨‹' : 'ç¼–è¾‘æµç¨‹'}</span>
          </Space>
        }
        extra={
          <Button 
            type="primary" 
            icon={<SaveOutlined />}
            loading={saving}
            onClick={() => form.submit()}
          >
            ä¿å­˜æµç¨‹
          </Button>
        }
      >
        <Row gutter={[16, 16]}>
          <Col span={8}>
            <Card title="åŸºæœ¬ä¿¡æ¯" size="small">
              <Form
                form={form}
                layout="vertical"
                onFinish={handleSave}
              >
                <Form.Item
                  name="key"
                  label="æµç¨‹æ ‡è¯†"
                  rules={[
                    { required: true, message: 'è¯·è¾“å…¥æµç¨‹æ ‡è¯†' },
                    { pattern: /^[a-zA-Z0-9_]+$/, message: 'åªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿' }
                  ]}
                >
                  <Input placeholder="process_key" disabled={id !== 'create'} />
                </Form.Item>
                
                <Form.Item
                  name="name"
                  label="æµç¨‹åç§°"
                  rules={[{ required: true, message: 'è¯·è¾“å…¥æµç¨‹åç§°' }]}
                >
                  <Input placeholder="è¯·è¾“å…¥æµç¨‹åç§°" />
                </Form.Item>
                
                <Form.Item name="category" label="æµç¨‹åˆ†ç±»">
                  <Select placeholder="é€‰æ‹©åˆ†ç±»">
                    <Select.Option value="approval">å®¡æ‰¹æµç¨‹</Select.Option>
                    <Select.Option value="workflow">å·¥ä½œæµç¨‹</Select.Option>
                    <Select.Option value="other">å…¶ä»–</Select.Option>
                  </Select>
                </Form.Item>
                
                <Form.Item name="description" label="æµç¨‹æè¿°">
                  <Input.TextArea 
                    placeholder="æè¿°æµç¨‹çš„ç”¨é€”å’Œç‰¹ç‚¹"
                    rows={4}
                  />
                </Form.Item>
              </Form>
            </Card>
          </Col>
          
          <Col span={16}>
            <Card title="æµç¨‹è®¾è®¡" size="small">
              <ProcessDesigner />
            </Card>
          </Col>
        </Row>
      </Card>
    </div>
  );
};

export default ProcessEdit;
```

**11:00-13:00 Wireä¾èµ–æ³¨å…¥æ›´æ–° (2å°æ—¶)**

æ›´æ–° `internal/wire/wire.go`:
```go
// æ·»åŠ Processç›¸å…³çš„Provider
var ProviderSet = wire.NewSet(
    // ç°æœ‰çš„Provider...
    
    // Process providers
    repository.NewProcessRepository,
    service.NewProcessService,
    
    // æ›´æ–°Server provider
    server.NewServer,
)
```

æ›´æ–° `internal/server/server.go`:
```go
func NewServer(
    cfg *config.Config,
    db *database.Database,
    log *logger.Logger,
    userService *service.UserService,
    processService *service.ProcessService, // æ–°å¢
    jwtManager *utils.JWTManager,
) *Server {
    // ...ç°æœ‰ä»£ç 
    
    // åˆ›å»ºrouteræ—¶ä¼ å…¥processService
    router := handler.NewRouter(userService, processService, jwtManager, log)
    
    // ...
}
```

#### ä¸‹åˆ (4å°æ—¶)
**14:00-16:00 è·¯ç”±é…ç½®æ›´æ–° (2å°æ—¶)**

æ›´æ–° `internal/handler/router.go`:
```go
func NewRouter(
    userService *service.UserService,
    processService *service.ProcessService, // æ–°å¢
    jwtManager *utils.JWTManager,
    logger *logger.Logger,
) *Router {
    userHandler := NewUserHandler(userService, logger)
    processHandler := NewProcessHandler(processService, logger) // æ–°å¢
    authMiddleware := middleware.NewAuthMiddleware(jwtManager, logger)

    return &Router{
        userHandler:    userHandler,
        processHandler: processHandler, // æ–°å¢
        authMiddleware: authMiddleware,
        logger:         logger,
    }
}

func (r *Router) SetupRoutes(e *echo.Echo) {
    // ...ç°æœ‰è·¯ç”±
    
    // Process routes (éœ€è¦è®¤è¯)
    process := api.Group("/process")
    process.Use(r.authMiddleware.JWTAuth())
    {
        process.GET("", r.processHandler.GetProcesses)
        process.POST("", r.processHandler.CreateProcess)
        process.GET("/:id", r.processHandler.GetProcess)
        process.PUT("/:id", r.processHandler.UpdateProcess)
        process.DELETE("/:id", r.processHandler.DeleteProcess)
        process.POST("/:id/copy", r.processHandler.CopyProcess)
        process.GET("/:id/versions", r.processHandler.GetProcessVersions)
    }
}
```

æ›´æ–°å‰ç«¯è·¯ç”± `src/App.tsx`:
```tsx
// åœ¨ProtectedRouteå†…æ·»åŠ æµç¨‹ç›¸å…³è·¯ç”±
<Route path="process" element={<ProcessList />} />
<Route path="process/create" element={<ProcessEdit />} />
<Route path="process/:id/edit" element={<ProcessEdit />} />
<Route path="process/:id/view" element={<ProcessDesigner />} />
```

**16:00-18:00 é›†æˆæµ‹è¯•å’Œè°ƒè¯• (2å°æ—¶)**

åˆ›å»ºæµ‹è¯•è„šæœ¬ `scripts/test_process_api.py`:
```python
#!/usr/bin/env python3
import requests
import json

BASE_URL = "http://localhost:8080/api/v1"

def test_process_apis():
    # ç™»å½•è·å–token
    login_response = requests.post(f"{BASE_URL}/auth/login", json={
        "username": "testuser",
        "password": "password123"
    })
    
    token = login_response.json()["data"]["token"]
    headers = {"Authorization": f"Bearer {token}"}
    
    # æµ‹è¯•åˆ›å»ºæµç¨‹
    create_data = {
        "key": "test_process",
        "name": "æµ‹è¯•æµç¨‹",
        "description": "è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æµç¨‹",
        "category": "approval",
        "definition": {
            "nodes": [
                {
                    "id": "start1",
                    "type": "start",
                    "name": "å¼€å§‹",
                    "x": 100,
                    "y": 100
                },
                {
                    "id": "task1", 
                    "type": "userTask",
                    "name": "å®¡æ ¸ä»»åŠ¡",
                    "x": 300,
                    "y": 100,
                    "props": {"assignee": "admin"}
                },
                {
                    "id": "end1",
                    "type": "end", 
                    "name": "ç»“æŸ",
                    "x": 500,
                    "y": 100
                }
            ],
            "flows": [
                {
                    "id": "flow1",
                    "from": "start1",
                    "to": "task1"
                },
                {
                    "id": "flow2", 
                    "from": "task1",
                    "to": "end1"
                }
            ]
        }
    }
    
    # æ‰§è¡Œæµ‹è¯•
    print("ğŸ§ª æµ‹è¯•æµç¨‹API...")
    
    # åˆ›å»ºæµç¨‹
    create_response = requests.post(f"{BASE_URL}/process", 
                                   json=create_data, headers=headers)
    print(f"åˆ›å»ºæµç¨‹: {create_response.status_code}")
    
    if create_response.status_code == 201:
        process_id = create_response.json()["data"]["id"]
        
        # è·å–æµç¨‹åˆ—è¡¨
        list_response = requests.get(f"{BASE_URL}/process", headers=headers)
        print(f"è·å–æµç¨‹åˆ—è¡¨: {list_response.status_code}")
        
        # è·å–æµç¨‹è¯¦æƒ…
        detail_response = requests.get(f"{BASE_URL}/process/{process_id}", headers=headers)
        print(f"è·å–æµç¨‹è¯¦æƒ…: {detail_response.status_code}")
        
        # æ›´æ–°æµç¨‹
        update_data = create_data.copy()
        update_data["name"] = "æ›´æ–°åçš„æµ‹è¯•æµç¨‹"
        update_response = requests.put(f"{BASE_URL}/process/{process_id}", 
                                     json=update_data, headers=headers)
        print(f"æ›´æ–°æµç¨‹: {update_response.status_code}")

if __name__ == "__main__":
    test_process_apis()
```

#### ğŸ“ Day 10 äº¤ä»˜æ¸…å•
- [ ] æµç¨‹åˆ›å»º/ç¼–è¾‘é¡µé¢å®Œæˆ
- [ ] æµç¨‹APIæœåŠ¡å®ç°
- [ ] Wireä¾èµ–æ³¨å…¥æ›´æ–°
- [ ] è·¯ç”±é…ç½®å®Œæˆ
- [ ] æµç¨‹APIæµ‹è¯•è„šæœ¬

---

## ğŸ“Š ç¬¬2å‘¨æ€»ç»“

### âœ… å®Œæˆçš„åŠŸèƒ½
1. **æµç¨‹æ•°æ®æ¨¡å‹** - å®Œæ•´çš„GORMæ¨¡å‹è®¾è®¡
2. **ReactFlowé›†æˆ** - å¯è§†åŒ–æµç¨‹å»ºæ¨¡å™¨
3. **æµç¨‹ç®¡ç†ç•Œé¢** - åˆ—è¡¨ã€åˆ›å»ºã€ç¼–è¾‘é¡µé¢
4. **APIæ¥å£** - å®Œæ•´çš„æµç¨‹CRUDæ“ä½œ
5. **æ•°æ®è½¬æ¢** - ReactFlowä¸å†…éƒ¨æ ¼å¼è½¬æ¢

### ğŸ“Š ä»£ç ç»Ÿè®¡é¢„ä¼°
- **åç«¯ä»£ç **: ~800è¡Œ (æ¨¡å‹ã€æœåŠ¡ã€API)
- **å‰ç«¯ä»£ç **: ~1200è¡Œ (ç»„ä»¶ã€é¡µé¢ã€å·¥å…·)
- **æµ‹è¯•ä»£ç **: ~200è¡Œ (APIæµ‹è¯•)
- **æ€»è®¡**: ~2200è¡Œä»£ç 

### ğŸ§ª æµ‹è¯•éªŒè¯
- [ ] æµç¨‹åˆ›å»ºå’Œä¿å­˜åŠŸèƒ½
- [ ] å¯è§†åŒ–å»ºæ¨¡å™¨æ“ä½œ
- [ ] æµç¨‹åˆ—è¡¨å’Œç®¡ç†åŠŸèƒ½
- [ ] å‰åç«¯APIé›†æˆ
- [ ] æ•°æ®æ ¼å¼è½¬æ¢æ­£ç¡®æ€§

### ğŸ“ ä¸‹å‘¨å‡†å¤‡
- æµç¨‹æ‰§è¡Œå¼•æ“å¼€å‘
- ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ
- æµç¨‹å®ä¾‹å’ŒçŠ¶æ€ç®¡ç†
- ç”¨æˆ·ä»»åŠ¡åˆ†é…å’Œå¤„ç†

---

**å¼€å‘è€…**: [å§“å]  
**å®Œæˆæ—¶é—´**: ç¬¬2å‘¨ Friday 18:00  
**ä¸‹å‘¨è®¡åˆ’**: æµç¨‹æ‰§è¡Œå¼•æ“å’Œä»»åŠ¡ç®¡ç†ç³»ç»Ÿå¼€å‘
