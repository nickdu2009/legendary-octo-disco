# MiniFlow 第1周详细开发计划

## 📋 周目标概览

**开发周期**: 第1周 (5天 × 8小时 = 40小时)  
**主要目标**: 搭建完整的开发环境和项目骨架，实现基础的用户管理功能  
**交付成果**: 可运行的前后端项目，具备用户注册、登录功能

---

## 📅 每日开发计划

### Day 1 (Monday) - 8小时
**主题**: 项目初始化和环境搭建

#### 上午 (4小时)
**9:00-11:00 后端项目初始化 (2小时)**
```bash
# 1. 创建项目目录结构 (30分钟)
mkdir -p miniflow/{backend,frontend,docs,scripts}
cd miniflow/backend

# 2. Go模块初始化 (30分钟)
go mod init miniflow
go get github.com/labstack/echo/v4
go get github.com/labstack/echo/v4/middleware
go get gorm.io/gorm
go get gorm.io/driver/mysql
go get github.com/golang-jwt/jwt/v4
go get github.com/spf13/viper
go get go.uber.org/zap

# 3. 创建基础目录结构 (60分钟)
mkdir -p {cmd/server,internal/{handler,service,repository,model},pkg/{config,database,logger,utils},config}
```

**项目结构创建**:
```
backend/
├── cmd/
│   └── server/
│       └── main.go
├── internal/
│   ├── handler/
│   ├── service/
│   ├── repository/
│   └── model/
├── pkg/
│   ├── config/
│   ├── database/
│   ├── logger/
│   └── utils/
├── config/
│   └── config.yaml
├── go.mod
└── go.sum
```

**11:00-13:00 基础配置文件 (2小时)**
- 创建 `config/config.yaml` 配置文件
- 实现 `pkg/config/config.go` 配置管理
- 创建 `pkg/logger/logger.go` 日志配置
- 编写 `cmd/server/main.go` 应用入口

#### 下午 (4小时)
**14:00-16:00 数据库连接配置 (2小时)**
- 实现 `pkg/database/database.go` 数据库连接
- 创建 `internal/model/base.go` 基础模型
- 实现数据库连接池配置
- 测试数据库连接

**16:00-18:00 Docker环境配置 (2小时)**
- 创建 `Dockerfile` 和 `docker-compose.yml`
- 配置MySQL数据库容器
- 配置Redis缓存容器
- 测试容器化环境

#### 📝 Day 1 交付清单
- [ ] Go项目结构完整创建
- [ ] 基础依赖包安装完成
- [ ] 配置管理系统实现
- [ ] 数据库连接配置完成
- [ ] Docker开发环境可用

---

### Day 2 (Tuesday) - 8小时
**主题**: 数据库模型设计和用户管理后端

#### 上午 (4小时)
**9:00-11:00 GORM模型定义 (2小时)**

创建 `internal/model/base.go`:
```go
package model

import (
    "time"
    "gorm.io/gorm"
)

type BaseModel struct {
    ID        uint           `gorm:"primaryKey;autoIncrement" json:"id"`
    CreatedAt time.Time      `gorm:"not null;index" json:"created_at"`
    UpdatedAt time.Time      `gorm:"not null" json:"updated_at"`
    DeletedAt gorm.DeletedAt `gorm:"index" json:"deleted_at,omitempty"`
}
```

创建 `internal/model/user.go`:
```go
package model

import "time"

type User struct {
    BaseModel
    Username    string     `gorm:"type:varchar(100);not null;uniqueIndex" json:"username"`
    Password    string     `gorm:"type:varchar(255);not null" json:"-"`
    DisplayName string     `gorm:"type:varchar(255)" json:"display_name"`
    Email       string     `gorm:"type:varchar(255);uniqueIndex" json:"email"`
    Phone       string     `gorm:"type:varchar(50)" json:"phone"`
    Role        string     `gorm:"type:varchar(50);not null;default:user;index" json:"role"`
    Status      string     `gorm:"type:varchar(20);not null;default:active;index" json:"status"`
    Avatar      string     `gorm:"type:varchar(500)" json:"avatar"`
    LastLoginAt *time.Time `json:"last_login_at"`
}

func (User) TableName() string {
    return "users"
}
```

**11:00-13:00 数据库迁移功能 (2小时)**
- 实现自动迁移功能
- 创建数据库初始化脚本
- 实现基础索引创建
- 测试数据库表创建

#### 下午 (4小时)
**14:00-16:00 用户Repository层 (2小时)**

创建 `internal/repository/user.go`:
```go
package repository

import (
    "miniflow/internal/model"
    "gorm.io/gorm"
)

type UserRepository struct {
    db *gorm.DB
}

func NewUserRepository(db *gorm.DB) *UserRepository {
    return &UserRepository{db: db}
}

func (r *UserRepository) Create(user *model.User) error {
    return r.db.Create(user).Error
}

func (r *UserRepository) GetByUsername(username string) (*model.User, error) {
    var user model.User
    err := r.db.Where("username = ? AND status = ?", username, "active").First(&user).Error
    if err != nil {
        return nil, err
    }
    return &user, nil
}

func (r *UserRepository) GetByID(id uint) (*model.User, error) {
    var user model.User
    err := r.db.First(&user, id).Error
    if err != nil {
        return nil, err
    }
    return &user, nil
}

func (r *UserRepository) Update(user *model.User) error {
    return r.db.Save(user).Error
}
```

**16:00-18:00 用户Service层 (2小时)**

创建 `internal/service/user.go`:
```go
package service

import (
    "errors"
    "time"
    "miniflow/internal/model"
    "miniflow/internal/repository"
    "miniflow/pkg/utils"
    "golang.org/x/crypto/bcrypt"
)

type UserService struct {
    userRepo *repository.UserRepository
}

func NewUserService(userRepo *repository.UserRepository) *UserService {
    return &UserService{userRepo: userRepo}
}

func (s *UserService) Register(req *RegisterRequest) (*model.User, error) {
    // 检查用户名是否存在
    existingUser, _ := s.userRepo.GetByUsername(req.Username)
    if existingUser != nil {
        return nil, errors.New("用户名已存在")
    }

    // 密码加密
    hashedPassword, err := bcrypt.GenerateFromPassword([]byte(req.Password), bcrypt.DefaultCost)
    if err != nil {
        return nil, err
    }

    // 创建用户
    user := &model.User{
        Username:    req.Username,
        Password:    string(hashedPassword),
        DisplayName: req.DisplayName,
        Email:       req.Email,
        Role:        "user",
        Status:      "active",
    }

    err = s.userRepo.Create(user)
    if err != nil {
        return nil, err
    }

    return user, nil
}

func (s *UserService) Login(username, password string) (*model.User, string, error) {
    user, err := s.userRepo.GetByUsername(username)
    if err != nil {
        return nil, "", errors.New("用户名或密码错误")
    }

    // 验证密码
    err = bcrypt.CompareHashAndPassword([]byte(user.Password), []byte(password))
    if err != nil {
        return nil, "", errors.New("用户名或密码错误")
    }

    // 生成JWT token
    token, err := utils.GenerateJWT(user.ID, user.Username)
    if err != nil {
        return nil, "", err
    }

    // 更新最后登录时间
    now := time.Now()
    user.LastLoginAt = &now
    s.userRepo.Update(user)

    return user, token, nil
}

type RegisterRequest struct {
    Username    string `json:"username" validate:"required,min=3,max=50"`
    Password    string `json:"password" validate:"required,min=6"`
    DisplayName string `json:"display_name"`
    Email       string `json:"email" validate:"email"`
}

type LoginRequest struct {
    Username string `json:"username" validate:"required"`
    Password string `json:"password" validate:"required"`
}
```

#### 📝 Day 2 交付清单
- [ ] 用户数据模型完成
- [ ] 数据库迁移功能实现
- [ ] 用户Repository层完成
- [ ] 用户Service层业务逻辑实现

---

### Day 3 (Wednesday) - 8小时
**主题**: 用户管理API和JWT认证

#### 上午 (4小时)
**9:00-11:00 JWT工具类实现 (2小时)**

创建 `pkg/utils/jwt.go`:
```go
package utils

import (
    "errors"
    "time"
    "github.com/golang-jwt/jwt/v4"
)

var jwtSecret = []byte("your-secret-key") // 实际使用中应从配置读取

type Claims struct {
    UserID   uint   `json:"user_id"`
    Username string `json:"username"`
    jwt.RegisteredClaims
}

func GenerateJWT(userID uint, username string) (string, error) {
    claims := Claims{
        UserID:   userID,
        Username: username,
        RegisteredClaims: jwt.RegisteredClaims{
            ExpiresAt: jwt.NewNumericDate(time.Now().Add(24 * time.Hour)),
            IssuedAt:  jwt.NewNumericDate(time.Now()),
            NotBefore: jwt.NewNumericDate(time.Now()),
        },
    }

    token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims)
    return token.SignedString(jwtSecret)
}

func ParseJWT(tokenString string) (*Claims, error) {
    token, err := jwt.ParseWithClaims(tokenString, &Claims{}, func(token *jwt.Token) (interface{}, error) {
        return jwtSecret, nil
    })

    if err != nil {
        return nil, err
    }

    if claims, ok := token.Claims.(*Claims); ok && token.Valid {
        return claims, nil
    }

    return nil, errors.New("invalid token")
}
```

**11:00-13:00 中间件实现 (2小时)**

创建 `internal/middleware/auth.go`:
```go
package middleware

import (
    "net/http"
    "strings"
    "miniflow/pkg/utils"
    "github.com/labstack/echo/v4"
)

func JWTAuth() echo.MiddlewareFunc {
    return func(next echo.HandlerFunc) echo.HandlerFunc {
        return func(c echo.Context) error {
            authHeader := c.Request().Header.Get("Authorization")
            if authHeader == "" {
                return c.JSON(http.StatusUnauthorized, map[string]string{"error": "缺少认证信息"})
            }

            tokenString := strings.Replace(authHeader, "Bearer ", "", 1)
            claims, err := utils.ParseJWT(tokenString)
            if err != nil {
                return c.JSON(http.StatusUnauthorized, map[string]string{"error": "无效的认证信息"})
            }

            c.Set("user_id", claims.UserID)
            c.Set("username", claims.Username)
            return next(c)
        }
    }
}

func Logger() echo.MiddlewareFunc {
    return echo.Logger()
}

func Recover() echo.MiddlewareFunc {
    return echo.Recover()
}

func CORS() echo.MiddlewareFunc {
    return echo.CORS()
}
```

#### 下午 (4小时)
**14:00-17:00 用户Handler层实现 (3小时)**

创建 `internal/handler/user.go`:
```go
package handler

import (
    "net/http"
    "miniflow/internal/service"
    "github.com/labstack/echo/v4"
    "github.com/go-playground/validator/v10"
)

type UserHandler struct {
    userService *service.UserService
    validator   *validator.Validate
}

func NewUserHandler(userService *service.UserService) *UserHandler {
    return &UserHandler{
        userService: userService,
        validator:   validator.New(),
    }
}

func (h *UserHandler) Register(c echo.Context) error {
    var req service.RegisterRequest
    if err := c.Bind(&req); err != nil {
        return c.JSON(http.StatusBadRequest, map[string]string{"error": "请求参数错误"})
    }

    if err := h.validator.Struct(&req); err != nil {
        return c.JSON(http.StatusBadRequest, map[string]string{"error": "参数验证失败"})
    }

    user, err := h.userService.Register(&req)
    if err != nil {
        return c.JSON(http.StatusBadRequest, map[string]string{"error": err.Error()})
    }

    return c.JSON(http.StatusCreated, map[string]interface{}{
        "message": "注册成功",
        "user":    user,
    })
}

func (h *UserHandler) Login(c echo.Context) error {
    var req service.LoginRequest
    if err := c.Bind(&req); err != nil {
        return c.JSON(http.StatusBadRequest, map[string]string{"error": "请求参数错误"})
    }

    if err := h.validator.Struct(&req); err != nil {
        return c.JSON(http.StatusBadRequest, map[string]string{"error": "参数验证失败"})
    }

    user, token, err := h.userService.Login(req.Username, req.Password)
    if err != nil {
        return c.JSON(http.StatusUnauthorized, map[string]string{"error": err.Error()})
    }

    return c.JSON(http.StatusOK, map[string]interface{}{
        "message": "登录成功",
        "user":    user,
        "token":   token,
    })
}

func (h *UserHandler) GetProfile(c echo.Context) error {
    userID := c.Get("user_id").(uint)
    // 这里可以调用service获取用户详细信息
    return c.JSON(http.StatusOK, map[string]interface{}{
        "user_id": userID,
        "message": "获取用户信息成功",
    })
}
```

**17:00-18:00 路由配置 (1小时)**

创建 `internal/handler/router.go`:
```go
package handler

import (
    "miniflow/internal/middleware"
    "github.com/labstack/echo/v4"
)

func SetupRoutes(e *echo.Echo, userHandler *UserHandler) {
    // 基础中间件
    e.Use(middleware.Logger())
    e.Use(middleware.Recover())
    e.Use(middleware.CORS())

    // API路由组
    api := e.Group("/api/v1")

    // 公开路由
    auth := api.Group("/auth")
    auth.POST("/register", userHandler.Register)
    auth.POST("/login", userHandler.Login)

    // 需要认证的路由
    protected := api.Group("/user")
    protected.Use(middleware.JWTAuth())
    protected.GET("/profile", userHandler.GetProfile)

    // 健康检查
    e.GET("/health", func(c echo.Context) error {
        return c.JSON(200, map[string]string{"status": "ok"})
    })
}
```

#### 📝 Day 3 交付清单
- [ ] JWT认证工具实现
- [ ] 认证中间件完成
- [ ] 用户Handler层实现
- [ ] 路由配置完成
- [ ] API接口可正常调用

---

### Day 4 (Thursday) - 8小时
**主题**: 前端项目搭建和认证系统

#### 上午 (4小时)
**9:00-11:00 React项目初始化 (2小时)**

```bash
cd ../frontend
npm create vite@latest . -- --template react-ts
npm install

# 安装依赖
npm install antd @ant-design/icons
npm install axios
npm install react-router-dom
npm install zustand
npm install @types/node

# 开发依赖
npm install -D @types/react @types/react-dom
npm install -D eslint @typescript-eslint/eslint-plugin
npm install -D prettier eslint-config-prettier
```

**项目结构创建**:
```
frontend/
├── src/
│   ├── components/
│   │   └── common/
│   ├── pages/
│   │   ├── auth/
│   │   ├── dashboard/
│   │   └── process/
│   ├── services/
│   ├── store/
│   ├── types/
│   ├── utils/
│   ├── App.tsx
│   └── main.tsx
├── public/
├── package.json
└── tsconfig.json
```

**11:00-13:00 基础配置和类型定义 (2小时)**

创建 `src/types/user.ts`:
```typescript
export interface User {
  id: number;
  username: string;
  display_name: string;
  email: string;
  phone?: string;
  role: string;
  status: string;
  avatar?: string;
  last_login_at?: string;
  created_at: string;
  updated_at: string;
}

export interface LoginRequest {
  username: string;
  password: string;
}

export interface RegisterRequest {
  username: string;
  password: string;
  display_name?: string;
  email?: string;
}

export interface AuthResponse {
  message: string;
  user: User;
  token: string;
}
```

创建 `src/utils/http.ts`:
```typescript
import axios, { AxiosInstance, AxiosRequestConfig, AxiosResponse } from 'axios';

class HttpClient {
  private instance: AxiosInstance;

  constructor() {
    this.instance = axios.create({
      baseURL: 'http://localhost:8080/api/v1',
      timeout: 10000,
      headers: {
        'Content-Type': 'application/json',
      },
    });

    this.setupInterceptors();
  }

  private setupInterceptors() {
    // 请求拦截器
    this.instance.interceptors.request.use(
      (config) => {
        const token = localStorage.getItem('token');
        if (token) {
          config.headers.Authorization = `Bearer ${token}`;
        }
        return config;
      },
      (error) => {
        return Promise.reject(error);
      }
    );

    // 响应拦截器
    this.instance.interceptors.response.use(
      (response: AxiosResponse) => {
        return response;
      },
      (error) => {
        if (error.response?.status === 401) {
          localStorage.removeItem('token');
          localStorage.removeItem('user');
          window.location.href = '/login';
        }
        return Promise.reject(error);
      }
    );
  }

  public get<T = any>(url: string, config?: AxiosRequestConfig): Promise<AxiosResponse<T>> {
    return this.instance.get(url, config);
  }

  public post<T = any>(url: string, data?: any, config?: AxiosRequestConfig): Promise<AxiosResponse<T>> {
    return this.instance.post(url, data, config);
  }

  public put<T = any>(url: string, data?: any, config?: AxiosRequestConfig): Promise<AxiosResponse<T>> {
    return this.instance.put(url, data, config);
  }

  public delete<T = any>(url: string, config?: AxiosRequestConfig): Promise<AxiosResponse<T>> {
    return this.instance.delete(url, config);
  }
}

export const http = new HttpClient();
```

#### 下午 (4小时)
**14:00-16:00 用户状态管理 (2小时)**

创建 `src/store/userStore.ts`:
```typescript
import { create } from 'zustand';
import { persist } from 'zustand/middleware';
import { User, LoginRequest, RegisterRequest, AuthResponse } from '../types/user';
import { userApi } from '../services/userApi';

interface UserState {
  user: User | null;
  token: string | null;
  loading: boolean;
  login: (data: LoginRequest) => Promise<void>;
  register: (data: RegisterRequest) => Promise<void>;
  logout: () => void;
  setUser: (user: User) => void;
  setToken: (token: string) => void;
}

export const useUserStore = create<UserState>()(
  persist(
    (set, get) => ({
      user: null,
      token: null,
      loading: false,

      login: async (data: LoginRequest) => {
        set({ loading: true });
        try {
          const response = await userApi.login(data);
          const { user, token } = response.data;
          
          set({ user, token, loading: false });
          localStorage.setItem('token', token);
        } catch (error) {
          set({ loading: false });
          throw error;
        }
      },

      register: async (data: RegisterRequest) => {
        set({ loading: true });
        try {
          await userApi.register(data);
          set({ loading: false });
        } catch (error) {
          set({ loading: false });
          throw error;
        }
      },

      logout: () => {
        set({ user: null, token: null });
        localStorage.removeItem('token');
        localStorage.removeItem('user');
      },

      setUser: (user: User) => set({ user }),
      setToken: (token: string) => set({ token }),
    }),
    {
      name: 'user-store',
      partialize: (state) => ({ user: state.user, token: state.token }),
    }
  )
);
```

**16:00-18:00 用户API服务 (2小时)**

创建 `src/services/userApi.ts`:
```typescript
import { http } from '../utils/http';
import { LoginRequest, RegisterRequest, AuthResponse, User } from '../types/user';

export const userApi = {
  login: (data: LoginRequest) => {
    return http.post<AuthResponse>('/auth/login', data);
  },

  register: (data: RegisterRequest) => {
    return http.post<{ message: string; user: User }>('/auth/register', data);
  },

  getProfile: () => {
    return http.get<{ user: User }>('/user/profile');
  },
};
```

#### 📝 Day 4 交付清单
- [ ] React + TypeScript项目搭建完成
- [ ] 基础依赖安装完成
- [ ] HTTP客户端工具实现
- [ ] 用户状态管理实现
- [ ] 用户API服务实现

---

### Day 5 (Friday) - 8小时
**主题**: 前端认证界面和基础布局

#### 上午 (4小时)
**9:00-11:00 登录注册页面 (2小时)**

创建 `src/pages/auth/Login.tsx`:
```typescript
import React from 'react';
import { Form, Input, Button, Card, message } from 'antd';
import { UserOutlined, LockOutlined } from '@ant-design/icons';
import { Link, useNavigate } from 'react-router-dom';
import { useUserStore } from '../../store/userStore';
import { LoginRequest } from '../../types/user';

const Login: React.FC = () => {
  const navigate = useNavigate();
  const { login, loading } = useUserStore();

  const onFinish = async (values: LoginRequest) => {
    try {
      await login(values);
      message.success('登录成功');
      navigate('/dashboard');
    } catch (error: any) {
      message.error(error.response?.data?.error || '登录失败');
    }
  };

  return (
    <div className="login-container">
      <Card title="登录" className="login-card">
        <Form
          name="login"
          onFinish={onFinish}
          autoComplete="off"
          size="large"
        >
          <Form.Item
            name="username"
            rules={[{ required: true, message: '请输入用户名!' }]}
          >
            <Input
              prefix={<UserOutlined />}
              placeholder="用户名"
            />
          </Form.Item>

          <Form.Item
            name="password"
            rules={[{ required: true, message: '请输入密码!' }]}
          >
            <Input.Password
              prefix={<LockOutlined />}
              placeholder="密码"
            />
          </Form.Item>

          <Form.Item>
            <Button
              type="primary"
              htmlType="submit"
              loading={loading}
              block
            >
              登录
            </Button>
          </Form.Item>

          <div className="auth-links">
            还没有账号? <Link to="/register">立即注册</Link>
          </div>
        </Form>
      </Card>
    </div>
  );
};

export default Login;
```

创建 `src/pages/auth/Register.tsx`:
```typescript
import React from 'react';
import { Form, Input, Button, Card, message } from 'antd';
import { UserOutlined, LockOutlined, MailOutlined } from '@ant-design/icons';
import { Link, useNavigate } from 'react-router-dom';
import { useUserStore } from '../../store/userStore';
import { RegisterRequest } from '../../types/user';

const Register: React.FC = () => {
  const navigate = useNavigate();
  const { register, loading } = useUserStore();

  const onFinish = async (values: RegisterRequest) => {
    try {
      await register(values);
      message.success('注册成功，请登录');
      navigate('/login');
    } catch (error: any) {
      message.error(error.response?.data?.error || '注册失败');
    }
  };

  return (
    <div className="register-container">
      <Card title="注册" className="register-card">
        <Form
          name="register"
          onFinish={onFinish}
          autoComplete="off"
          size="large"
        >
          <Form.Item
            name="username"
            rules={[
              { required: true, message: '请输入用户名!' },
              { min: 3, message: '用户名至少3个字符!' }
            ]}
          >
            <Input
              prefix={<UserOutlined />}
              placeholder="用户名"
            />
          </Form.Item>

          <Form.Item
            name="display_name"
          >
            <Input
              prefix={<UserOutlined />}
              placeholder="显示名称"
            />
          </Form.Item>

          <Form.Item
            name="email"
            rules={[
              { type: 'email', message: '请输入有效的邮箱地址!' }
            ]}
          >
            <Input
              prefix={<MailOutlined />}
              placeholder="邮箱"
            />
          </Form.Item>

          <Form.Item
            name="password"
            rules={[
              { required: true, message: '请输入密码!' },
              { min: 6, message: '密码至少6个字符!' }
            ]}
          >
            <Input.Password
              prefix={<LockOutlined />}
              placeholder="密码"
            />
          </Form.Item>

          <Form.Item
            name="confirm_password"
            dependencies={['password']}
            rules={[
              { required: true, message: '请确认密码!' },
              ({ getFieldValue }) => ({
                validator(_, value) {
                  if (!value || getFieldValue('password') === value) {
                    return Promise.resolve();
                  }
                  return Promise.reject(new Error('两次输入的密码不一致!'));
                },
              }),
            ]}
          >
            <Input.Password
              prefix={<LockOutlined />}
              placeholder="确认密码"
            />
          </Form.Item>

          <Form.Item>
            <Button
              type="primary"
              htmlType="submit"
              loading={loading}
              block
            >
              注册
            </Button>
          </Form.Item>

          <div className="auth-links">
            已有账号? <Link to="/login">立即登录</Link>
          </div>
        </Form>
      </Card>
    </div>
  );
};

export default Register;
```

**11:00-13:00 主布局组件 (2小时)**

创建 `src/components/layout/MainLayout.tsx`:
```typescript
import React from 'react';
import { Layout, Menu, Dropdown, Avatar, Button } from 'antd';
import {
  UserOutlined,
  SettingOutlined,
  LogoutOutlined,
  MenuFoldOutlined,
  MenuUnfoldOutlined,
  DashboardOutlined,
  ApartmentOutlined,
  CheckSquareOutlined,
} from '@ant-design/icons';
import { useNavigate, useLocation, Outlet } from 'react-router-dom';
import { useUserStore } from '../../store/userStore';

const { Header, Sider, Content } = Layout;

const MainLayout: React.FC = () => {
  const navigate = useNavigate();
  const location = useLocation();
  const { user, logout } = useUserStore();
  const [collapsed, setCollapsed] = React.useState(false);

  const menuItems = [
    {
      key: '/dashboard',
      icon: <DashboardOutlined />,
      label: '仪表板',
    },
    {
      key: '/process',
      icon: <ApartmentOutlined />,
      label: '流程管理',
    },
    {
      key: '/tasks',
      icon: <CheckSquareOutlined />,
      label: '我的任务',
    },
  ];

  const userMenuItems = [
    {
      key: 'profile',
      icon: <UserOutlined />,
      label: '个人资料',
    },
    {
      key: 'settings',
      icon: <SettingOutlined />,
      label: '设置',
    },
    {
      type: 'divider' as const,
    },
    {
      key: 'logout',
      icon: <LogoutOutlined />,
      label: '退出登录',
      onClick: () => {
        logout();
        navigate('/login');
      },
    },
  ];

  const handleMenuClick = ({ key }: { key: string }) => {
    navigate(key);
  };

  return (
    <Layout style={{ minHeight: '100vh' }}>
      <Sider trigger={null} collapsible collapsed={collapsed}>
        <div className="logo">
          <h2 style={{ color: 'white', textAlign: 'center', margin: '16px 0' }}>
            {collapsed ? 'MF' : 'MiniFlow'}
          </h2>
        </div>
        <Menu
          theme="dark"
          mode="inline"
          selectedKeys={[location.pathname]}
          items={menuItems}
          onClick={handleMenuClick}
        />
      </Sider>
      <Layout>
        <Header style={{ padding: '0 16px', background: '#fff', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
          <Button
            type="text"
            icon={collapsed ? <MenuUnfoldOutlined /> : <MenuFoldOutlined />}
            onClick={() => setCollapsed(!collapsed)}
          />
          <div>
            <Dropdown menu={{ items: userMenuItems }} placement="bottomRight">
              <div style={{ cursor: 'pointer', display: 'flex', alignItems: 'center' }}>
                <Avatar icon={<UserOutlined />} src={user?.avatar} />
                <span style={{ marginLeft: 8 }}>{user?.display_name || user?.username}</span>
              </div>
            </Dropdown>
          </div>
        </Header>
        <Content style={{ margin: '16px', padding: '16px', background: '#fff', minHeight: 280 }}>
          <Outlet />
        </Content>
      </Layout>
    </Layout>
  );
};

export default MainLayout;
```

#### 下午 (4小时)
**14:00-16:00 路由配置和App组件 (2小时)**

创建 `src/components/auth/ProtectedRoute.tsx`:
```typescript
import React from 'react';
import { Navigate } from 'react-router-dom';
import { useUserStore } from '../../store/userStore';

interface ProtectedRouteProps {
  children: React.ReactNode;
}

const ProtectedRoute: React.FC<ProtectedRouteProps> = ({ children }) => {
  const { token } = useUserStore();

  if (!token) {
    return <Navigate to="/login" replace />;
  }

  return <>{children}</>;
};

export default ProtectedRoute;
```

创建 `src/pages/dashboard/Dashboard.tsx`:
```typescript
import React from 'react';
import { Card, Row, Col, Statistic } from 'antd';
import { ApartmentOutlined, CheckSquareOutlined, ClockCircleOutlined } from '@ant-design/icons';

const Dashboard: React.FC = () => {
  return (
    <div>
      <h2>仪表板</h2>
      <Row gutter={16}>
        <Col span={8}>
          <Card>
            <Statistic
              title="我的流程"
              value={0}
              prefix={<ApartmentOutlined />}
            />
          </Card>
        </Col>
        <Col span={8}>
          <Card>
            <Statistic
              title="待办任务"
              value={0}
              prefix={<CheckSquareOutlined />}
            />
          </Card>
        </Col>
        <Col span={8}>
          <Card>
            <Statistic
              title="已完成任务"
              value={0}
              prefix={<ClockCircleOutlined />}
            />
          </Card>
        </Col>
      </Row>
    </div>
  );
};

export default Dashboard;
```

更新 `src/App.tsx`:
```typescript
import React from 'react';
import { BrowserRouter as Router, Routes, Route, Navigate } from 'react-router-dom';
import { ConfigProvider } from 'antd';
import zhCN from 'antd/locale/zh_CN';
import Login from './pages/auth/Login';
import Register from './pages/auth/Register';
import MainLayout from './components/layout/MainLayout';
import Dashboard from './pages/dashboard/Dashboard';
import ProtectedRoute from './components/auth/ProtectedRoute';
import './App.css';

function App() {
  return (
    <ConfigProvider locale={zhCN}>
      <Router>
        <Routes>
          <Route path="/login" element={<Login />} />
          <Route path="/register" element={<Register />} />
          <Route
            path="/"
            element={
              <ProtectedRoute>
                <MainLayout />
              </ProtectedRoute>
            }
          >
            <Route index element={<Navigate to="/dashboard" replace />} />
            <Route path="dashboard" element={<Dashboard />} />
            <Route path="process" element={<div>流程管理页面开发中...</div>} />
            <Route path="tasks" element={<div>任务管理页面开发中...</div>} />
          </Route>
        </Routes>
      </Router>
    </ConfigProvider>
  );
}

export default App;
```

**16:00-18:00 样式和最终集成测试 (2小时)**

创建 `src/App.css`:
```css
.login-container,
.register-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.login-card,
.register-card {
  width: 400px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.auth-links {
  text-align: center;
  margin-top: 16px;
}

.logo {
  height: 64px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-bottom: 1px solid #f0f0f0;
}

/* 响应式设计 */
@media (max-width: 768px) {
  .login-card,
  .register-card {
    width: 90%;
    margin: 0 16px;
  }
}
```

更新 `src/main.tsx`:
```typescript
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App.tsx'
import 'antd/dist/reset.css'
import './App.css'

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
)
```

#### 📝 Day 5 交付清单
- [ ] 登录注册页面完成
- [ ] 主布局组件实现
- [ ] 路由保护机制完成
- [ ] 基础仪表板页面
- [ ] 前后端联调成功
- [ ] 响应式设计实现

---

## 🎯 第1周总结

### ✅ 完成的功能
1. **项目基础架构**
   - Go后端项目结构完整
   - React前端项目搭建完成
   - Docker开发环境配置

2. **用户管理系统**
   - 用户注册、登录功能
   - JWT认证机制
   - 用户状态管理

3. **前端界面**
   - 登录注册页面
   - 主布局框架
   - 基础仪表板
   - 响应式设计

4. **技术基础**
   - GORM数据库模型
   - Echo Web框架集成
   - React + TypeScript + Ant Design
   - 状态管理和路由配置

### 📊 代码统计
- **后端代码**: ~1500行
- **前端代码**: ~1200行
- **配置文件**: ~300行
- **总计**: ~3000行代码

### 🧪 测试验证
- [ ] 用户注册功能正常
- [ ] 用户登录获取JWT Token
- [ ] 认证中间件拦截未授权请求
- [ ] 前端页面正常显示
- [ ] 前后端API调用成功
- [ ] 数据库数据正确存储

### 📝 下周准备
- 流程定义数据模型设计
- 流程管理API接口规划
- 前端流程列表页面设计
- ReactFlow集成方案调研

---

**开发者**: [姓名]  
**完成时间**: 第1周 Friday 18:00  
**下周计划**: 流程定义管理功能开发
