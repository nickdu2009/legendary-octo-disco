# MiniFlow ç¬¬3å‘¨è¯¦ç»†å¼€å‘è®¡åˆ’
## æµç¨‹æ‰§è¡Œå¼•æ“å’Œä»»åŠ¡ç®¡ç†ç³»ç»Ÿå¼€å‘

**å¼€å‘å‘¨æœŸ**: ç¬¬3å‘¨ (5å¤© Ã— 8å°æ—¶ = 40å°æ—¶)  
**ä¸»è¦ç›®æ ‡**: å®ç°æµç¨‹æ‰§è¡Œå¼•æ“å’Œå®Œæ•´çš„ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ  
**æŠ€æœ¯é‡ç‚¹**: æµç¨‹å®ä¾‹æ‰§è¡Œã€ä»»åŠ¡åˆ†é…å¤„ç†ã€çŠ¶æ€è·Ÿè¸ªç›‘æ§  
**äº¤ä»˜æˆæœ**: å®Œæ•´å¯è¿è¡Œçš„æµç¨‹æ‰§è¡Œå’Œä»»åŠ¡ç®¡ç†å¹³å°

---

## ğŸ“‹ ç¬¬3å‘¨ç›®æ ‡æ¦‚è§ˆ

### **ğŸ¯ æ ¸å¿ƒç›®æ ‡**
åŸºäºç¬¬2å‘¨å®Œæˆçš„æµç¨‹å»ºæ¨¡å’Œç®¡ç†ç³»ç»Ÿï¼Œç¬¬3å‘¨å°†å®ç°ï¼š
1. **æµç¨‹æ‰§è¡Œå¼•æ“** - å°†è®¾è®¡çš„æµç¨‹è½¬åŒ–ä¸ºå¯æ‰§è¡Œçš„å®ä¾‹
2. **ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ** - ç”¨æˆ·ä»»åŠ¡åˆ†é…ã€å¤„ç†ã€è·Ÿè¸ª
3. **æµç¨‹ç›‘æ§ç³»ç»Ÿ** - æµç¨‹å®ä¾‹çŠ¶æ€ç›‘æ§å’Œç®¡ç†
4. **ç”¨æˆ·å·¥ä½œå°** - ä¸ªäººä»»åŠ¡å¤„ç†ç•Œé¢
5. **ç³»ç»Ÿé›†æˆä¼˜åŒ–** - å®Œæ•´çš„ç«¯åˆ°ç«¯ä¸šåŠ¡æµç¨‹

### **ğŸ—ï¸ æŠ€æœ¯åŸºç¡€ (ç¬¬2å‘¨å·²å®Œæˆ)**
- âœ… **æµç¨‹ç®¡ç†åç«¯** - å®Œæ•´çš„APIå’Œæ•°æ®æ¨¡å‹
- âœ… **å¯è§†åŒ–å»ºæ¨¡å™¨** - ç”Ÿäº§çº§çš„æµç¨‹è®¾è®¡å·¥å…·
- âœ… **APIé›†æˆç³»ç»Ÿ** - å‰åç«¯å®Œæ•´æ•°æ®æµ
- âœ… **ç³»ç»Ÿæ¶æ„** - æ¸…æ™°çš„ç›®å½•ç»“æ„å’Œå¯¼èˆª
- âœ… **æµ‹è¯•éªŒè¯** - 100%ç³»ç»Ÿé›†æˆæµ‹è¯•é€šè¿‡

---

## ğŸ“… æ¯æ—¥å¼€å‘è®¡åˆ’

### Day 11 (Monday) - 8å°æ—¶
**ä¸»é¢˜**: æµç¨‹æ‰§è¡Œå¼•æ“æ ¸å¿ƒå¼€å‘

#### ä¸Šåˆ (4å°æ—¶)
**9:00-11:00 æµç¨‹å®ä¾‹æ•°æ®æ¨¡å‹æ‰©å±• (2å°æ—¶)**

åŸºäºç¬¬2å‘¨çš„ProcessInstanceæ¨¡å‹ï¼Œæ‰©å±•æ‰§è¡Œå¼•æ“éœ€è¦çš„å­—æ®µï¼š
```go
// æ‰©å±• ProcessInstance æ¨¡å‹
type ProcessInstance struct {
    BaseModel
    DefinitionID    uint                   `gorm:"not null;index" json:"definition_id"`
    BusinessKey     string                 `gorm:"type:varchar(255);index" json:"business_key"`
    StartTime       *time.Time             `json:"start_time"`
    EndTime         *time.Time             `json:"end_time"`
    Status          string                 `gorm:"type:varchar(20);not null;default:running;index" json:"status"`
    CurrentNode     string                 `gorm:"type:varchar(64)" json:"current_node"`
    Variables       string                 `gorm:"type:json" json:"variables"`
    StarterID       uint                   `gorm:"not null;index" json:"starter_id"`
    
    // æ‰§è¡Œå¼•æ“ç›¸å…³å­—æ®µ
    ExecutionPath   string                 `gorm:"type:json" json:"execution_path"`
    SuspendReason   string                 `gorm:"type:varchar(255)" json:"suspend_reason"`
    Priority        int                    `gorm:"default:50" json:"priority"`
    DueDate         *time.Time             `json:"due_date"`
    
    // å…³è”å…³ç³»
    Definition ProcessDefinition `gorm:"foreignKey:DefinitionID" json:"definition,omitempty"`
    Starter    User              `gorm:"foreignKey:StarterID" json:"starter,omitempty"`
    Tasks      []TaskInstance    `gorm:"foreignKey:InstanceID;constraint:OnDelete:CASCADE" json:"tasks,omitempty"`
}

// æµç¨‹å®ä¾‹çŠ¶æ€
const (
    InstanceStatusRunning   = "running"
    InstanceStatusSuspended = "suspended"
    InstanceStatusCompleted = "completed"
    InstanceStatusFailed    = "failed"
    InstanceStatusCancelled = "cancelled"
)
```

**11:00-13:00 ä»»åŠ¡å®ä¾‹æ¨¡å‹å®Œå–„ (2å°æ—¶)**

æ‰©å±•TaskInstanceæ¨¡å‹ï¼Œæ”¯æŒä»»åŠ¡æ‰§è¡Œå’ŒçŠ¶æ€ç®¡ç†ï¼š
```go
// æ‰©å±• TaskInstance æ¨¡å‹
type TaskInstance struct {
    BaseModel
    InstanceID      uint                   `gorm:"not null;index" json:"instance_id"`
    NodeID          string                 `gorm:"type:varchar(64);not null;index" json:"node_id"`
    Name            string                 `gorm:"type:varchar(255);not null" json:"name"`
    AssigneeID      *uint                  `gorm:"index" json:"assignee_id"`
    Status          string                 `gorm:"type:varchar(20);not null;default:created;index" json:"status"`
    Priority        int                    `gorm:"not null;default:50;index" json:"priority"`
    DueDate         *time.Time             `gorm:"index" json:"due_date"`
    ClaimTime       *time.Time             `json:"claim_time"`
    CompleteTime    *time.Time             `json:"complete_time"`
    Comment         string                 `gorm:"type:text" json:"comment"`
    FormData        string                 `gorm:"type:json" json:"form_data"`
    
    // æ‰§è¡Œå¼•æ“ç›¸å…³å­—æ®µ
    TaskType        string                 `gorm:"type:varchar(50);not null;index" json:"task_type"`
    ExecutionData   string                 `gorm:"type:json" json:"execution_data"`
    RetryCount      int                    `gorm:"default:0" json:"retry_count"`
    MaxRetries      int                    `gorm:"default:3" json:"max_retries"`
    ErrorMessage    string                 `gorm:"type:text" json:"error_message"`
    
    // å…³è”å…³ç³»
    Instance ProcessInstance `gorm:"foreignKey:InstanceID" json:"instance,omitempty"`
    Assignee *User           `gorm:"foreignKey:AssigneeID" json:"assignee,omitempty"`
}

// ä»»åŠ¡çŠ¶æ€
const (
    TaskStatusCreated    = "created"
    TaskStatusAssigned   = "assigned"
    TaskStatusClaimed    = "claimed"
    TaskStatusInProgress = "in_progress"
    TaskStatusCompleted  = "completed"
    TaskStatusFailed     = "failed"
    TaskStatusSkipped    = "skipped"
)
```

#### ä¸‹åˆ (4å°æ—¶)
**14:00-16:00 æµç¨‹æ‰§è¡Œå¼•æ“æ ¸å¿ƒ (2å°æ—¶)**

åˆ›å»º `internal/engine/process_engine.go`:
```go
type ProcessEngine struct {
    instanceRepo *repository.ProcessInstanceRepository
    taskRepo     *repository.TaskRepository
    userRepo     *repository.UserRepository
    logger       *logger.Logger
}

// æ ¸å¿ƒæ‰§è¡Œæ–¹æ³•
func (e *ProcessEngine) StartProcess(definitionID uint, starterID uint, businessKey string, variables map[string]interface{}) (*model.ProcessInstance, error)
func (e *ProcessEngine) CompleteTask(taskID uint, userID uint, formData map[string]interface{}, comment string) error
func (e *ProcessEngine) SuspendInstance(instanceID uint, reason string) error
func (e *ProcessEngine) ResumeInstance(instanceID uint) error
func (e *ProcessEngine) CancelInstance(instanceID uint, reason string) error

// ä»»åŠ¡åˆ†é…å’Œå¤„ç†
func (e *ProcessEngine) AssignTask(taskID uint, assigneeID uint) error
func (e *ProcessEngine) ClaimTask(taskID uint, userID uint) error
func (e *ProcessEngine) ReleaseTask(taskID uint) error
func (e *ProcessEngine) DelegateTask(taskID uint, fromUserID uint, toUserID uint) error

// æµç¨‹æ¨è¿›é€»è¾‘
func (e *ProcessEngine) moveToNextNode(instance *model.ProcessInstance, currentNodeID string) error
func (e *ProcessEngine) createTasksForNode(instance *model.ProcessInstance, nodeID string) error
func (e *ProcessEngine) evaluateGatewayConditions(instance *model.ProcessInstance, gatewayNodeID string) ([]string, error)
```

**16:00-18:00 ä»»åŠ¡åˆ†é…ç­–ç•¥ (2å°æ—¶)**

åˆ›å»º `internal/engine/task_assignment.go`:
```go
type TaskAssignmentStrategy interface {
    AssignTask(task *model.TaskInstance, availableUsers []*model.User) (*model.User, error)
}

// ç›´æ¥åˆ†é…ç­–ç•¥
type DirectAssignmentStrategy struct{}
func (s *DirectAssignmentStrategy) AssignTask(task *model.TaskInstance, users []*model.User) (*model.User, error)

// è½®è¯¢åˆ†é…ç­–ç•¥  
type RoundRobinStrategy struct{}
func (s *RoundRobinStrategy) AssignTask(task *model.TaskInstance, users []*model.User) (*model.User, error)

// è´Ÿè½½å‡è¡¡ç­–ç•¥
type LoadBalancingStrategy struct{}
func (s *LoadBalancingStrategy) AssignTask(task *model.TaskInstance, users []*model.User) (*model.User, error)

// ä¼˜å…ˆçº§ç­–ç•¥
type PriorityBasedStrategy struct{}
func (s *PriorityBasedStrategy) AssignTask(task *model.TaskInstance, users []*model.User) (*model.User, error)
```

#### ğŸ“ Day 11 äº¤ä»˜æ¸…å•
- [ ] æµç¨‹å®ä¾‹æ•°æ®æ¨¡å‹æ‰©å±•
- [ ] ä»»åŠ¡å®ä¾‹æ¨¡å‹å®Œå–„
- [ ] æµç¨‹æ‰§è¡Œå¼•æ“æ ¸å¿ƒå®ç°
- [ ] ä»»åŠ¡åˆ†é…ç­–ç•¥ç³»ç»Ÿ
- [ ] æ•°æ®åº“è¿ç§»å’Œç´¢å¼•ä¼˜åŒ–

---

### Day 12 (Tuesday) - 8å°æ—¶
**ä¸»é¢˜**: æµç¨‹æ‰§è¡ŒAPIå’Œä»»åŠ¡ç®¡ç†API

#### ä¸Šåˆ (4å°æ—¶)
**9:00-11:00 æµç¨‹æ‰§è¡ŒAPI (2å°æ—¶)**

åˆ›å»º `internal/handler/process_execution.go`:
```go
type ProcessExecutionHandler struct {
    engine  *engine.ProcessEngine
    logger  *logger.Logger
}

// æµç¨‹å®ä¾‹ç®¡ç†API
func (h *ProcessExecutionHandler) StartProcess(c echo.Context) error      // POST /api/v1/process/:id/start
func (h *ProcessExecutionHandler) GetInstance(c echo.Context) error       // GET /api/v1/instance/:id
func (h *ProcessExecutionHandler) GetInstances(c echo.Context) error      // GET /api/v1/instances
func (h *ProcessExecutionHandler) SuspendInstance(c echo.Context) error   // POST /api/v1/instance/:id/suspend
func (h *ProcessExecutionHandler) ResumeInstance(c echo.Context) error    // POST /api/v1/instance/:id/resume
func (h *ProcessExecutionHandler) CancelInstance(c echo.Context) error    // POST /api/v1/instance/:id/cancel
func (h *ProcessExecutionHandler) GetInstanceHistory(c echo.Context) error // GET /api/v1/instance/:id/history
```

**11:00-13:00 ä»»åŠ¡ç®¡ç†API (2å°æ—¶)**

åˆ›å»º `internal/handler/task_management.go`:
```go
type TaskManagementHandler struct {
    engine  *engine.ProcessEngine
    logger  *logger.Logger
}

// ä»»åŠ¡ç®¡ç†API
func (h *TaskManagementHandler) GetUserTasks(c echo.Context) error        // GET /api/v1/user/tasks
func (h *TaskManagementHandler) GetTask(c echo.Context) error             // GET /api/v1/task/:id
func (h *TaskManagementHandler) ClaimTask(c echo.Context) error           // POST /api/v1/task/:id/claim
func (h *TaskManagementHandler) CompleteTask(c echo.Context) error        // POST /api/v1/task/:id/complete
func (h *TaskManagementHandler) ReleaseTask(c echo.Context) error         // POST /api/v1/task/:id/release
func (h *TaskManagementHandler) DelegateTask(c echo.Context) error        // POST /api/v1/task/:id/delegate
func (h *TaskManagementHandler) GetTaskForm(c echo.Context) error         // GET /api/v1/task/:id/form
func (h *TaskManagementHandler) SubmitTaskForm(c echo.Context) error      // POST /api/v1/task/:id/form
```

#### ä¸‹åˆ (4å°æ—¶)
**14:00-16:00 æµç¨‹å˜é‡å’Œæ¡ä»¶å¼•æ“ (2å°æ—¶)**

åˆ›å»º `internal/engine/variable_engine.go`:
```go
type VariableEngine struct {
    logger *logger.Logger
}

// å˜é‡ç®¡ç†
func (e *VariableEngine) SetVariable(instanceID uint, key string, value interface{}) error
func (e *VariableEngine) GetVariable(instanceID uint, key string) (interface{}, error)
func (e *VariableEngine) GetAllVariables(instanceID uint) (map[string]interface{}, error)
func (e *VariableEngine) EvaluateCondition(condition string, variables map[string]interface{}) (bool, error)

// æ¡ä»¶è¡¨è¾¾å¼è§£æ
func (e *VariableEngine) parseExpression(expression string) (*ast.Node, error)
func (e *VariableEngine) evaluateNode(node *ast.Node, variables map[string]interface{}) (interface{}, error)
```

**16:00-18:00 æœåŠ¡ä»»åŠ¡æ‰§è¡Œå™¨ (2å°æ—¶)**

åˆ›å»º `internal/engine/service_executor.go`:
```go
type ServiceExecutor struct {
    httpClient *http.Client
    logger     *logger.Logger
}

// æœåŠ¡ä»»åŠ¡æ‰§è¡Œ
func (e *ServiceExecutor) ExecuteHTTPService(task *model.TaskInstance) error
func (e *ServiceExecutor) ExecuteDatabaseService(task *model.TaskInstance) error
func (e *ServiceExecutor) ExecuteEmailService(task *model.TaskInstance) error
func (e *ServiceExecutor) ExecuteScriptService(task *model.TaskInstance) error

// å¼‚æ­¥æ‰§è¡Œæ”¯æŒ
func (e *ServiceExecutor) ExecuteAsync(task *model.TaskInstance, callback func(result interface{}, err error)) error
func (e *ServiceExecutor) GetExecutionResult(taskID uint) (*ExecutionResult, error)
```

#### ğŸ“ Day 12 äº¤ä»˜æ¸…å•
- [ ] æµç¨‹æ‰§è¡ŒAPIå®Œæ•´å®ç°
- [ ] ä»»åŠ¡ç®¡ç†APIå®Œæ•´å®ç°
- [ ] æµç¨‹å˜é‡å’Œæ¡ä»¶å¼•æ“
- [ ] æœåŠ¡ä»»åŠ¡æ‰§è¡Œå™¨
- [ ] APIè·¯ç”±é…ç½®å’Œé›†æˆ

---

### Day 13 (Wednesday) - 8å°æ—¶
**ä¸»é¢˜**: å‰ç«¯ä»»åŠ¡ç®¡ç†ç•Œé¢å’Œæµç¨‹ç›‘æ§

#### ä¸Šåˆ (4å°æ—¶)
**9:00-11:00 ä»»åŠ¡åˆ—è¡¨å’Œå·¥ä½œå° (2å°æ—¶)**

åˆ›å»º `src/pages/tasks/TaskWorkspace.tsx`:
```tsx
const TaskWorkspace: React.FC = () => {
  // ä»»åŠ¡åˆ—è¡¨ã€ç­›é€‰ã€æœç´¢
  // ä»»åŠ¡è¯¦æƒ…æŸ¥çœ‹
  // ä»»åŠ¡è®¤é¢†å’Œå¤„ç†
  // ä»»åŠ¡è¡¨å•å¡«å†™
  // ä»»åŠ¡å®Œæˆæäº¤
  
  return (
    <div className="task-workspace">
      <Row gutter={[16, 16]}>
        <Col span={8}>
          <Card title="æˆ‘çš„ä»»åŠ¡">
            <TaskList 
              filters={{ assignee: currentUser.id, status: 'assigned' }}
              onTaskSelect={setSelectedTask}
            />
          </Card>
        </Col>
        <Col span={16}>
          <Card title="ä»»åŠ¡è¯¦æƒ…">
            {selectedTask ? (
              <TaskDetailPanel 
                task={selectedTask}
                onComplete={handleTaskComplete}
                onClaim={handleTaskClaim}
              />
            ) : (
              <Empty description="è¯·é€‰æ‹©ä¸€ä¸ªä»»åŠ¡æŸ¥çœ‹è¯¦æƒ…" />
            )}
          </Card>
        </Col>
      </Row>
    </div>
  );
};
```

**11:00-13:00 æµç¨‹å®ä¾‹ç›‘æ§ (2å°æ—¶)**

åˆ›å»º `src/pages/process/ProcessMonitor.tsx`:
```tsx
const ProcessMonitor: React.FC = () => {
  // æµç¨‹å®ä¾‹åˆ—è¡¨
  // å®ä¾‹çŠ¶æ€ç›‘æ§
  // æµç¨‹è¿›åº¦å¯è§†åŒ–
  // å®ä¾‹æ“ä½œ (æš‚åœã€æ¢å¤ã€å–æ¶ˆ)
  
  return (
    <div className="process-monitor">
      <Card title="æµç¨‹å®ä¾‹ç›‘æ§">
        <Table 
          columns={instanceColumns}
          dataSource={instances}
          expandable={{
            expandedRowRender: (instance) => (
              <ProcessInstanceDetail instance={instance} />
            )
          }}
        />
      </Card>
    </div>
  );
};
```

#### ä¸‹åˆ (4å°æ—¶)
**14:00-16:00 ä»»åŠ¡è¡¨å•ç³»ç»Ÿ (2å°æ—¶)**

åˆ›å»º `src/components/tasks/DynamicTaskForm.tsx`:
```tsx
const DynamicTaskForm: React.FC = ({ taskDefinition, onSubmit }) => {
  // åŠ¨æ€è¡¨å•ç”Ÿæˆ
  // è¡¨å•éªŒè¯
  // æ•°æ®æäº¤
  
  const renderFormField = (field: FormField) => {
    switch (field.type) {
      case 'text': return <Input {...field.props} />;
      case 'number': return <InputNumber {...field.props} />;
      case 'select': return <Select {...field.props} />;
      case 'date': return <DatePicker {...field.props} />;
      case 'textarea': return <TextArea {...field.props} />;
      default: return <Input {...field.props} />;
    }
  };
  
  return (
    <Form onFinish={onSubmit}>
      {taskDefinition.formFields.map(field => (
        <Form.Item key={field.name} {...field.validation}>
          {renderFormField(field)}
        </Form.Item>
      ))}
    </Form>
  );
};
```

**16:00-18:00 æµç¨‹å¯è§†åŒ–è·Ÿè¸ª (2å°æ—¶)**

åˆ›å»º `src/components/process/ProcessTracker.tsx`:
```tsx
const ProcessTracker: React.FC = ({ instance }) => {
  // æµç¨‹è¿›åº¦å¯è§†åŒ–
  // å½“å‰èŠ‚ç‚¹é«˜äº®
  // å·²å®Œæˆè·¯å¾„æ˜¾ç¤º
  // ä»»åŠ¡çŠ¶æ€æ ‡è¯†
  
  return (
    <div className="process-tracker">
      <ReactFlow
        nodes={enhancedNodes}
        edges={enhancedEdges}
        nodeTypes={trackingNodeTypes}
        fitView
        interactive={false}
      >
        <Background />
        <Controls showInteractive={false} />
      </ReactFlow>
    </div>
  );
};
```

#### ğŸ“ Day 13 äº¤ä»˜æ¸…å•
- [ ] ä»»åŠ¡å·¥ä½œå°ç•Œé¢å®Œæˆ
- [ ] æµç¨‹å®ä¾‹ç›‘æ§é¡µé¢
- [ ] åŠ¨æ€ä»»åŠ¡è¡¨å•ç³»ç»Ÿ
- [ ] æµç¨‹å¯è§†åŒ–è·Ÿè¸ªç»„ä»¶
- [ ] å‰ç«¯ä»»åŠ¡ç®¡ç†APIé›†æˆ

---

### Day 14 (Thursday) - 8å°æ—¶
**ä¸»é¢˜**: æµç¨‹æ‰§è¡Œé€»è¾‘å’Œä»»åŠ¡å¤„ç†æµç¨‹

#### ä¸Šåˆ (4å°æ—¶)
**9:00-11:00 æµç¨‹æ‰§è¡Œé€»è¾‘å®ç° (2å°æ—¶)**

å®ç°æµç¨‹æ¨è¿›æ ¸å¿ƒé€»è¾‘ï¼š
```go
// æµç¨‹æ‰§è¡Œæ ¸å¿ƒé€»è¾‘
func (e *ProcessEngine) ExecuteProcess(instance *model.ProcessInstance) error {
    definition := instance.Definition
    currentNode := e.findNodeByID(definition.DefinitionJSON, instance.CurrentNode)
    
    switch currentNode.Type {
    case "start":
        return e.handleStartNode(instance, currentNode)
    case "userTask":
        return e.handleUserTask(instance, currentNode)
    case "serviceTask":
        return e.handleServiceTask(instance, currentNode)
    case "gateway":
        return e.handleGateway(instance, currentNode)
    case "end":
        return e.handleEndNode(instance, currentNode)
    default:
        return errors.New("ä¸æ”¯æŒçš„èŠ‚ç‚¹ç±»å‹")
    }
}

// ç½‘å…³æ¡ä»¶è¯„ä¼°
func (e *ProcessEngine) evaluateGateway(instance *model.ProcessInstance, gateway *ProcessNode) ([]string, error) {
    variables := e.getInstanceVariables(instance.ID)
    
    switch gateway.Props["gatewayType"] {
    case "exclusive":
        return e.evaluateExclusiveGateway(gateway, variables)
    case "parallel":
        return e.evaluateParallelGateway(gateway, variables)
    case "inclusive":
        return e.evaluateInclusiveGateway(gateway, variables)
    default:
        return nil, errors.New("ä¸æ”¯æŒçš„ç½‘å…³ç±»å‹")
    }
}
```

**11:00-13:00 ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç† (2å°æ—¶)**

å®ç°ä»»åŠ¡çŠ¶æ€è½¬æ¢å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼š
```go
// ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†
type TaskLifecycleManager struct {
    taskRepo *repository.TaskRepository
    engine   *ProcessEngine
    logger   *logger.Logger
}

func (m *TaskLifecycleManager) CreateTask(instance *model.ProcessInstance, nodeID string) (*model.TaskInstance, error)
func (m *TaskLifecycleManager) AssignTask(taskID uint, assigneeID uint) error
func (m *TaskLifecycleManager) ClaimTask(taskID uint, userID uint) error
func (m *TaskLifecycleManager) CompleteTask(taskID uint, userID uint, result map[string]interface{}) error
func (m *TaskLifecycleManager) HandleTaskTimeout(taskID uint) error
func (m *TaskLifecycleManager) HandleTaskEscalation(taskID uint) error

// ä»»åŠ¡çŠ¶æ€è½¬æ¢éªŒè¯
func (m *TaskLifecycleManager) validateTransition(from, to string) error
func (m *TaskLifecycleManager) notifyTaskStatusChange(task *model.TaskInstance, oldStatus, newStatus string) error
```

#### ä¸‹åˆ (4å°æ—¶)
**14:00-16:00 æµç¨‹å®ä¾‹çŠ¶æ€æœº (2å°æ—¶)**

å®ç°æµç¨‹å®ä¾‹çŠ¶æ€ç®¡ç†ï¼š
```go
type ProcessStateMachine struct {
    engine *ProcessEngine
    logger *logger.Logger
}

// çŠ¶æ€è½¬æ¢
func (sm *ProcessStateMachine) TransitionTo(instance *model.ProcessInstance, newStatus string, reason string) error
func (sm *ProcessStateMachine) CanTransition(from, to string) bool
func (sm *ProcessStateMachine) GetAvailableTransitions(currentStatus string) []string

// çŠ¶æ€å¤„ç†
func (sm *ProcessStateMachine) handleRunningState(instance *model.ProcessInstance) error
func (sm *ProcessStateMachine) handleSuspendedState(instance *model.ProcessInstance) error
func (sm *ProcessStateMachine) handleCompletedState(instance *model.ProcessInstance) error
func (sm *ProcessStateMachine) handleFailedState(instance *model.ProcessInstance) error
```

**16:00-18:00 äº‹ä»¶å’Œé€šçŸ¥ç³»ç»Ÿ (2å°æ—¶)**

åˆ›å»º `internal/engine/event_system.go`:
```go
type EventSystem struct {
    subscribers map[string][]EventHandler
    logger      *logger.Logger
}

type Event struct {
    Type      string                 `json:"type"`
    Source    string                 `json:"source"`
    Data      map[string]interface{} `json:"data"`
    Timestamp time.Time              `json:"timestamp"`
}

// äº‹ä»¶ç±»å‹
const (
    EventProcessStarted   = "process.started"
    EventProcessCompleted = "process.completed"
    EventTaskCreated      = "task.created"
    EventTaskCompleted    = "task.completed"
    EventTaskAssigned     = "task.assigned"
    EventTaskOverdue      = "task.overdue"
)

func (es *EventSystem) Publish(event *Event) error
func (es *EventSystem) Subscribe(eventType string, handler EventHandler) error
func (es *EventSystem) Unsubscribe(eventType string, handler EventHandler) error
```

#### ğŸ“ Day 14 äº¤ä»˜æ¸…å•
- [ ] æµç¨‹æ‰§è¡Œé€»è¾‘å®Œæ•´å®ç°
- [ ] ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†
- [ ] æµç¨‹å®ä¾‹çŠ¶æ€æœº
- [ ] äº‹ä»¶å’Œé€šçŸ¥ç³»ç»Ÿ
- [ ] æ‰§è¡Œå¼•æ“é›†æˆæµ‹è¯•

---

### Day 15 (Friday) - 8å°æ—¶
**ä¸»é¢˜**: å‰ç«¯ä»»åŠ¡å¤„ç†ç•Œé¢å’Œæµç¨‹ç›‘æ§é›†æˆ

#### ä¸Šåˆ (4å°æ—¶)
**9:00-11:00 ä»»åŠ¡å¤„ç†ç•Œé¢ (2å°æ—¶)**

åˆ›å»ºç”¨æˆ·ä»»åŠ¡å¤„ç†çš„å®Œæ•´ç•Œé¢ï¼š
```tsx
// src/pages/tasks/TaskDetail.tsx
const TaskDetail: React.FC = () => {
  return (
    <Card title="ä»»åŠ¡è¯¦æƒ…">
      <Descriptions>
        <Descriptions.Item label="ä»»åŠ¡åç§°">{task.name}</Descriptions.Item>
        <Descriptions.Item label="æµç¨‹åç§°">{task.processName}</Descriptions.Item>
        <Descriptions.Item label="ä¼˜å…ˆçº§">{task.priority}</Descriptions.Item>
        <Descriptions.Item label="åˆ°æœŸæ—¶é—´">{task.dueDate}</Descriptions.Item>
      </Descriptions>
      
      <DynamicTaskForm 
        formFields={task.formFields}
        onSubmit={handleTaskSubmit}
      />
      
      <Space>
        <Button type="primary" onClick={handleComplete}>å®Œæˆä»»åŠ¡</Button>
        <Button onClick={handleClaim}>è®¤é¢†ä»»åŠ¡</Button>
        <Button onClick={handleDelegate}>å§”æ´¾ä»»åŠ¡</Button>
      </Space>
    </Card>
  );
};
```

**11:00-13:00 æµç¨‹å®ä¾‹ç›‘æ§ç•Œé¢ (2å°æ—¶)**

åˆ›å»ºæµç¨‹æ‰§è¡Œç›‘æ§ç•Œé¢ï¼š
```tsx
// src/pages/process/InstanceMonitor.tsx
const InstanceMonitor: React.FC = () => {
  return (
    <div className="instance-monitor">
      <Row gutter={[16, 16]}>
        <Col span={16}>
          <Card title="æµç¨‹å®ä¾‹åˆ—è¡¨">
            <Table 
              columns={instanceColumns}
              dataSource={instances}
              expandable={{
                expandedRowRender: (instance) => (
                  <ProcessTracker instance={instance} />
                )
              }}
            />
          </Card>
        </Col>
        <Col span={8}>
          <Card title="å®ä¾‹ç»Ÿè®¡">
            <Statistic title="è¿è¡Œä¸­" value={runningCount} />
            <Statistic title="å·²å®Œæˆ" value={completedCount} />
            <Statistic title="å·²æš‚åœ" value={suspendedCount} />
          </Card>
        </Col>
      </Row>
    </div>
  );
};
```

#### ä¸‹åˆ (4å°æ—¶)
**14:00-16:00 APIé›†æˆå’Œæ•°æ®æµ (2å°æ—¶)**

å®Œå–„å‰ç«¯APIæœåŠ¡ï¼š
```tsx
// src/services/executionApi.ts
export const executionApi = {
  // æµç¨‹å®ä¾‹API
  async startProcess(definitionId: number, businessKey: string, variables: any): Promise<ProcessInstance>
  async getInstances(params: InstanceQueryParams): Promise<InstanceListResponse>
  async getInstance(instanceId: number): Promise<ProcessInstance>
  async suspendInstance(instanceId: number, reason: string): Promise<void>
  async resumeInstance(instanceId: number): Promise<void>
  async cancelInstance(instanceId: number, reason: string): Promise<void>
  
  // ä»»åŠ¡API
  async getUserTasks(userId: number, params: TaskQueryParams): Promise<TaskListResponse>
  async getTask(taskId: number): Promise<TaskInstance>
  async claimTask(taskId: number): Promise<void>
  async completeTask(taskId: number, formData: any, comment: string): Promise<void>
  async delegateTask(taskId: number, toUserId: number): Promise<void>
};
```

**16:00-18:00 å®æ—¶æ›´æ–°å’ŒWebSocket (2å°æ—¶)**

å®ç°å®æ—¶ä»»åŠ¡å’Œæµç¨‹çŠ¶æ€æ›´æ–°ï¼š
```tsx
// src/hooks/useRealtimeUpdates.ts
export const useRealtimeUpdates = (instanceId?: number) => {
  const [socket, setSocket] = useState<WebSocket | null>(null);
  
  useEffect(() => {
    const ws = new WebSocket(`ws://localhost:8080/ws/updates`);
    
    ws.onmessage = (event) => {
      const update = JSON.parse(event.data);
      handleRealtimeUpdate(update);
    };
    
    setSocket(ws);
    
    return () => ws.close();
  }, [instanceId]);
  
  return { socket, isConnected: socket?.readyState === WebSocket.OPEN };
};
```

#### ğŸ“ Day 15 äº¤ä»˜æ¸…å•
- [ ] ä»»åŠ¡å¤„ç†ç•Œé¢å®Œæˆ
- [ ] æµç¨‹å®ä¾‹ç›‘æ§ç•Œé¢
- [ ] å‰ç«¯APIæœåŠ¡é›†æˆ
- [ ] å®æ—¶æ›´æ–°ç³»ç»Ÿ
- [ ] WebSocketè¿æ¥å®ç°

---

## ğŸ“Š ç¬¬3å‘¨æŠ€æœ¯é‡ç‚¹

### **1. æµç¨‹æ‰§è¡Œå¼•æ“æ¶æ„**
```
ğŸ“¦ æ‰§è¡Œå¼•æ“æ ¸å¿ƒ
â”œâ”€â”€ ProcessEngine - æµç¨‹æ‰§è¡Œæ ¸å¿ƒ
â”œâ”€â”€ TaskLifecycleManager - ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸ
â”œâ”€â”€ VariableEngine - å˜é‡å’Œæ¡ä»¶å¼•æ“
â”œâ”€â”€ ServiceExecutor - æœåŠ¡ä»»åŠ¡æ‰§è¡Œå™¨
â”œâ”€â”€ ProcessStateMachine - æµç¨‹çŠ¶æ€æœº
â””â”€â”€ EventSystem - äº‹ä»¶é€šçŸ¥ç³»ç»Ÿ
```

### **2. ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ**
```
ğŸ“¦ ä»»åŠ¡ç®¡ç†æ ¸å¿ƒ
â”œâ”€â”€ TaskWorkspace - ç”¨æˆ·å·¥ä½œå°
â”œâ”€â”€ TaskDetail - ä»»åŠ¡è¯¦æƒ…å¤„ç†
â”œâ”€â”€ DynamicTaskForm - åŠ¨æ€è¡¨å•ç³»ç»Ÿ
â”œâ”€â”€ TaskAssignment - ä»»åŠ¡åˆ†é…ç­–ç•¥
â”œâ”€â”€ TaskNotification - ä»»åŠ¡é€šçŸ¥ç³»ç»Ÿ
â””â”€â”€ TaskReporting - ä»»åŠ¡æŠ¥è¡¨ç»Ÿè®¡
```

### **3. å‰ç«¯ç•Œé¢ç³»ç»Ÿ**
```
ğŸ“¦ ç”¨æˆ·ç•Œé¢
â”œâ”€â”€ pages/tasks/ - ä»»åŠ¡ç®¡ç†é¡µé¢
â”œâ”€â”€ pages/instances/ - æµç¨‹å®ä¾‹é¡µé¢
â”œâ”€â”€ components/tasks/ - ä»»åŠ¡ç›¸å…³ç»„ä»¶
â”œâ”€â”€ components/execution/ - æ‰§è¡Œç›¸å…³ç»„ä»¶
â”œâ”€â”€ services/executionApi.ts - æ‰§è¡ŒAPIæœåŠ¡
â””â”€â”€ hooks/useRealtimeUpdates.ts - å®æ—¶æ›´æ–°Hook
```

---

## ğŸ¯ ç¬¬3å‘¨äº¤ä»˜ç›®æ ‡

### **æ ¸å¿ƒåŠŸèƒ½ç›®æ ‡**
- **æµç¨‹æ‰§è¡Œå¼•æ“** - å®Œæ•´çš„æµç¨‹å®ä¾‹æ‰§è¡Œèƒ½åŠ›
- **ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ** - ç”¨æˆ·ä»»åŠ¡åˆ†é…å’Œå¤„ç†
- **æµç¨‹ç›‘æ§ç³»ç»Ÿ** - å®ä¾‹çŠ¶æ€è·Ÿè¸ªå’Œç®¡ç†
- **ç”¨æˆ·å·¥ä½œå°** - ä¸ªäººä»»åŠ¡å¤„ç†ç•Œé¢
- **å®æ—¶æ›´æ–°ç³»ç»Ÿ** - WebSocketå®æ—¶çŠ¶æ€åŒæ­¥

### **æŠ€æœ¯æŒ‡æ ‡ç›®æ ‡**
- **æµç¨‹æ‰§è¡Œæ€§èƒ½**: å®ä¾‹å¯åŠ¨ < 200ms
- **ä»»åŠ¡åˆ†é…å»¶è¿Ÿ**: < 100ms
- **ç•Œé¢å“åº”é€Ÿåº¦**: < 500ms
- **å®æ—¶æ›´æ–°å»¶è¿Ÿ**: < 50ms
- **ç³»ç»Ÿç¨³å®šæ€§**: > 99%

### **ç”¨æˆ·ä½“éªŒç›®æ ‡**
- **ä»»åŠ¡å¤„ç†æµç¨‹**: ç›´è§‚ç®€å•ï¼Œ3æ­¥å†…å®Œæˆ
- **æµç¨‹ç›‘æ§ç•Œé¢**: å®æ—¶çŠ¶æ€ï¼Œä¸€ç›®äº†ç„¶
- **è¡¨å•å¡«å†™ä½“éªŒ**: åŠ¨æ€ç”Ÿæˆï¼Œæ™ºèƒ½éªŒè¯
- **é€šçŸ¥æé†’ç³»ç»Ÿ**: åŠæ—¶å‡†ç¡®ï¼Œä¸æ‰“æ‰°

---

## ğŸš€ ç¬¬3å‘¨æˆåŠŸæ ‡å‡†

### **åŠŸèƒ½å®Œæ•´æ€§**
- [ ] æµç¨‹å¯ä»¥ä»å®šä¹‰åˆ°æ‰§è¡Œçš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ
- [ ] ç”¨æˆ·å¯ä»¥æ¥æ”¶ã€å¤„ç†ã€å®Œæˆä»»åŠ¡
- [ ] ç®¡ç†å‘˜å¯ä»¥ç›‘æ§å’Œç®¡ç†æµç¨‹å®ä¾‹
- [ ] ç³»ç»Ÿå¯ä»¥å¤„ç†å„ç§å¼‚å¸¸å’Œé”™è¯¯æƒ…å†µ

### **æŠ€æœ¯è´¨é‡**
- [ ] ä»£ç è´¨é‡è¾¾åˆ°ä¼ä¸šçº§æ ‡å‡†
- [ ] APIæ€§èƒ½æ»¡è¶³é¢„æœŸæŒ‡æ ‡
- [ ] å‰ç«¯ç•Œé¢å“åº”æµç•…
- [ ] ç³»ç»Ÿç¨³å®šæ€§ç»è¿‡éªŒè¯

### **ç”¨æˆ·ä½“éªŒ**
- [ ] ä»»åŠ¡å¤„ç†æµç¨‹ç®€å•ç›´è§‚
- [ ] æµç¨‹ç›‘æ§ä¿¡æ¯æ¸…æ™°å®Œæ•´
- [ ] å®æ—¶æ›´æ–°åŠæ—¶å‡†ç¡®
- [ ] é”™è¯¯æç¤ºå‹å¥½æœ‰ç”¨

---

## ğŸ’¡ ç¬¬3å‘¨å¼€å‘ç­–ç•¥

### **æŠ€æœ¯é€‰å‹**
- **åç«¯æ‰§è¡Œå¼•æ“**: Go + çŠ¶æ€æœºæ¨¡å¼
- **å®æ—¶é€šä¿¡**: WebSocket + Server-Sent Events
- **ä»»åŠ¡é˜Ÿåˆ—**: Redis + å¼‚æ­¥å¤„ç†
- **äº‹ä»¶ç³»ç»Ÿ**: å‘å¸ƒè®¢é˜…æ¨¡å¼
- **å‰ç«¯çŠ¶æ€**: React Query + WebSocket

### **å¼€å‘ä¼˜å…ˆçº§**
1. **ğŸ”¥ é«˜ä¼˜å…ˆçº§**: æµç¨‹æ‰§è¡Œå¼•æ“æ ¸å¿ƒ - åŸºç¡€åŠŸèƒ½
2. **ğŸ”¥ é«˜ä¼˜å…ˆçº§**: ä»»åŠ¡ç®¡ç†API - ç”¨æˆ·æ ¸å¿ƒéœ€æ±‚
3. **âš¡ ä¸­ä¼˜å…ˆçº§**: å‰ç«¯ä»»åŠ¡ç•Œé¢ - ç”¨æˆ·ä½“éªŒ
4. **âš¡ ä¸­ä¼˜å…ˆçº§**: å®æ—¶æ›´æ–°ç³»ç»Ÿ - ç³»ç»Ÿå®Œæ•´æ€§
5. **ğŸ“‹ æ ‡å‡†ä¼˜å…ˆçº§**: ç›‘æ§å’ŒæŠ¥è¡¨ - ç®¡ç†éœ€æ±‚

---

**ğŸ¯ ç¬¬3å‘¨å¼€å‘è®¡åˆ’åˆ¶å®šå®Œæˆï¼åŸºäºç¬¬2å‘¨çš„åšå®åŸºç¡€ï¼Œç¬¬3å‘¨å°†å®ç°å®Œæ•´çš„æµç¨‹æ‰§è¡Œå’Œä»»åŠ¡ç®¡ç†èƒ½åŠ›ï¼** ğŸš€

---

**è§„åˆ’äººå‘˜**: MiniFlow Team  
**åˆ¶å®šæ—¶é—´**: 2025-10-24 18:30  
**åŸºç¡€**: ç¬¬2å‘¨100%å®Œæˆçš„æµç¨‹å»ºæ¨¡å’Œç®¡ç†ç³»ç»Ÿ  
**ç›®æ ‡**: å®Œæ•´å¯è¿è¡Œçš„ä¼ä¸šçº§æµç¨‹æ‰§è¡Œå¹³å°
